# WEBçŸ¥è¯†è¡¥å……è¯¾ç¨‹

#### è¯¾ç¨‹å†…å®¹å®‰æ’ï¼š

- #### å¿«é€Ÿä½¿ç”¨Nginxå’ŒuWSGIä¸¤ä¸ªæœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®

  - ##### NginxæœåŠ¡å™¨è®¾ç½®å¤šä¸ªæœåŠ¡èŠ‚ç‚¹

  - ##### uWSGIå¯åŠ¨æœåŠ¡çš„ä¸¤ç§æ–¹å¼

- #### è§£å†³è·¨åŸŸè¯·æ±‚é™åˆ¶çš„ç®€å•æ–¹æ³•ï¼Œè®¤è¯†æµè§ˆå™¨çš„åŒæºç­–ç•¥

  - ##### æµè§ˆå™¨çš„åŒæºç­–ç•¥æ˜¯é€ æˆè·¨åŸŸè¯·æ±‚é™åˆ¶çš„ä¸»è¦åŸå› 

  - ##### é€šè¿‡å“åº”å¤´ä¿¡æ¯å‘ŠçŸ¥æµè§ˆå™¨å½“å‰æœåŠ¡å™¨å…è®¸æ¥è‡ªæŸä¸ªåŸŸåçš„è·¨åŸŸè¯·æ±‚

- #### äº†è§£æˆ‘ä»¬ä½¿ç”¨çš„ORMæ¨¡å—æ˜¯å¦‚ä½•é€šè¿‡æˆ‘ä»¬å®šä¹‰çš„æ¨¡å‹ç±»è·å–åˆ°å­—æ®µä¿¡æ¯çš„

  - ##### å…ƒç±»ï¼Œåˆ›å»ºç±»çš„å¤šç§æ–¹å¼

  - ##### å®ç°çˆ¶ç±»è‡ªåŠ¨æ³¨å†Œå®ƒçš„å­ç±»

- #### åŸºäºuWSGIæœåŠ¡å™¨å’ŒWSGIåè®®æ„å»ºä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹è¾ƒä¸ºé½å…¨çš„ä¸“é—¨é€‚ç”¨äºå‰åç«¯åˆ†ç¦»çš„WEBæ¡†æ¶

  - ##### è®¾è®¡æ¡†æ¶é¡¹ç›®çš„æ¨¡å—ã€æ–‡ä»¶ã€‘ç»“æ„

  - ##### äº†è§£uWSGIæœåŠ¡å™¨æä¾›çš„ç»™æ¡†æ¶çš„ä¿¡æ¯ï¼Œå¹¶ç­›é€‰å‡ºWEBåœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°è¯·æ±‚ä¿¡æ¯

  - ##### ä¾æ®æœåŠ¡å™¨æä¾›ç»™æ¡†æ¶çš„è¯·æ±‚ä¿¡æ¯å†…å®¹æ„å»ºæˆ‘ä»¬æ¡†æ¶çš„requestå¯¹è±¡çš„ç±»

  - ##### æ„å»ºsessionå·¥å…·ç±»å’Œç”¨æ¥åˆ›å»ºå¹¶è®°å½•ä¸­é—´ä»¶ç±»çš„å…ƒç±»_MiniFrameMetaClass

  - ##### æ„å»ºä¸­é—´ä»¶çš„åŸºç±»ï¼Œè®¾è®¡ä¸­é—´ä»¶æ–¹æ³•

  - ##### äº†è§£HTTPè¯·æ±‚çš„æ–¹å¼æœ‰å“ªäº›ï¼Œå¹¶æ ¹æ®è¿™äº›è¯·æ±‚æ–¹å¼è®¾è®¡è·¯ç”±æ¨¡å—å’Œç±»è§†å›¾åŸºç±»

  - ##### äº†è§£éœ€è¦æ¡†æ¶å’Œå¼€å‘è€…è®¾ç½®çš„å“åº”å¤´çš„å†…å®¹æœ‰å“ªäº›ï¼Œå¹¶æ ¹æ®è¿™äº›ç±»å®¹è®¾è®¡æˆ‘çš„å“åº”å¤„ç†çš„ç›¸å…³æ¨¡å—

  - ##### è®¾è®¡å¹¶æ„å»ºæ ¸å¿ƒçš„Applicationç±»

- #### è®¾è®¡æˆ‘ä»¬æƒ³è¦çš„é¡¹ç›®åˆå§‹ç»“æ„ï¼Œå’Œæ–‡ä»¶å†…å®¹

  - ##### é¢„æƒ³ä¸­çš„é¡¹ç›®æ–‡ä»¶ã€æ¨¡å—ã€‘ç»“æ„

  - ##### å„ä¸ªæ–‡ä»¶ã€æ¨¡å—ã€‘ä¸­çš„å†…å®¹

- #### å®‰è£…miniFrameæ¡†æ¶åˆ°site-packagesä¸­ï¼Œå¹¶å®Œå–„å¥½æ¡†æ¶éœ€è¦æä¾›çš„shellå‘½ä»¤

  - ##### äº†è§£å°†è‡ªå·±å¼€å‘çš„æ¨¡å—å®‰è£…åˆ°ç¯å¢ƒä¸­éœ€è¦åˆ›å»ºè‡³å°‘å“ªäº›æ–‡ä»¶

  - ##### è®¾è®¡ç¼–è¾‘å®Œæˆæ¨¡å—shellå‘½ä»¤çš„Pythonè„šæœ¬

------



## ä¸€ã€ä½¿ç”¨Nginxå’ŒuWSGIä¸¤ä¸ªæœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®

- #### ä½¿ç”¨NginxæœåŠ¡å™¨ä½œä¸ºé™æ€æ–‡ä»¶æœåŠ¡

  - ##### å®‰è£…NginxæœåŠ¡å™¨

  ```
  sudo apt-get install nginx
  ```

  Ubuntuå®‰è£…ä¹‹åçš„æ–‡ä»¶ç»“æ„å¤§è‡´ä¸ºï¼š

  æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åœ¨/etc/nginxä¸‹ï¼Œå¹¶ä¸”é»˜è®¤å¯åŠ¨ä½¿ç”¨çš„å…·ä½“é…ç½®åœ¨/etc/nginx/sites-availableä¸‹

  ç¨‹åºæ–‡ä»¶åœ¨/usr/sbin/nginx

  æ—¥å¿—æ”¾åœ¨äº†/var/log/nginxä¸­

  å¹¶å·²ç»åœ¨/etc/init.d/ä¸‹åˆ›å»ºäº†å¯åŠ¨è„šæœ¬nginx

  é»˜è®¤èµ„æºçš„ç›®å½•è®¾ç½®åœ¨äº†/var/www (æœ‰çš„ç‰ˆæœ¬è®¾ç½®åœ¨äº†/var/www/nginx-default, è¯·å‚è€ƒ/etc/nginx/sites-availableé‡Œçš„é…ç½®)

  ![image-20180728091427491](./media/work-miniFrame-images/image-20180728091427491.png)

  - ##### å¯åŠ¨NginxæœåŠ¡å™¨ï¼Œå¹¶å°†å®ƒä½œä¸ºæˆ‘ä»¬çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ã€‚

  ```shell
  # å¯åŠ¨å‘½ä»¤æœ‰ä¸¤ç§æ–¹å¼ï¼š
  
  sudo /etc/init.d/nginx start	# æ–¹å¼ä¸€
  sudo service nginx start		# æ–¹å¼äºŒ
  
  # å…¶å®è¿™ä¸¤ç§å¯åŠ¨æ–¹å¼çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å»è¿è¡Œåœ¨ /etc/init.d/ çš„nginxå¯åŠ¨è„šæœ¬ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æƒ³é€šè¿‡ sudo service XXX start è¿™ç§æœåŠ¡ç®¡ç†å™¨çš„æ–¹å¼ç®¡ç†æŸä¸ªè½¯ä»¶çš„è¿è¡Œçš„æ—¶å€™å°±å¯ä»¥å°†æ”¹è½¯ä»¶çš„å¯åŠ¨è„šæœ¬æ·»åŠ åˆ° /etc/init.d æ–‡ä»¶å¤¹ä¸‹é¢å»ã€å‰æï¼šè¯¥è½¯ä»¶æ”¯æŒshellè„šæœ¬å¯åŠ¨ã€‘
  ```

  æŸ¥çœ‹é»˜è®¤å¯åŠ¨é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œå­¦ä¹ å¦‚ä½•é…ç½®NginxæœåŠ¡å™¨ã€‚

  ###### ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹ /etc/nginx/nginx.conf ä¸­çš„å†…å®¹ï¼Œå› ä¸ºNginxæœåŠ¡å™¨ä¸€èˆ¬éƒ½æ˜¯ä»¥è¿™ä¸ªé…ç½®æ–‡ä»¶å¯åŠ¨çš„

  æ‰¾åˆ°å…³é”®çš„å­—ç¬¦ä¸² "# Virtual Host Configs"

  ![image-20180728091801477](./media/work-miniFrame-images/image-20180728091801477.png)

  è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç›´æ¥å¤§å¹…åº¦çš„ä¿®æ”¹ç¼–è¾‘é»˜è®¤çš„ nginx.conf æ–‡ä»¶ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡ include å°†æˆ‘ä»¬è‡ªå·±çš„é…ç½®æ–‡ä»¶åŒ…å«è¿›å»ã€‚

  ###### ç¬¬äºŒæ­¥ï¼šç¼–è¾‘ä¸ºæˆ‘ä»¬é¡¹ç›®æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶è·¯å¾„åŒ…å«åˆ° nginx.conf ä¸­

  ```shell
  # ä¸ºMiniWebé¡¹ç›®æœåŠ¡çš„nginxé…ç½®æ–‡ä»¶
  # æˆ‘ä»¬å°†é™æ€çš„htmlï¼Œcssï¼Œjsèµ„æºäº¤ç»™nginxæœåŠ¡å™¨ï¼Œå› ä¸ºnginxæœåŠ¡å™¨åœ¨è¿™æ–¹é¢æ›´åŠ æ“…é•¿ï¼Œè€Œå…¶ä¹Ÿå¯ä»¥åŒæ—¶å¸®åŠ©æˆ‘ä»¬å®ç°å‰åç«¯åˆ†ç¦»
  
  # é…ç½®æœåŠ¡èŠ‚ç‚¹ server
  
  # é™æ€æ–‡ä»¶çš„æœåŠ¡èŠ‚ç‚¹
  server {
      # è®¾ç½®ç›‘å¬çš„ç«¯å£
      listen       80;
      # è®¾ç½®æœåŠ¡å™¨åŸŸåï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸è®¾ç½®
      server_name  www.miniweb.com;
  
      # è®¾ç½®é™æ€èµ„æºçš„è·¯ç”±åŒ¹é…èŠ‚ç‚¹
      location / {
  		# è®¾ç½®é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„
          root   /home/itcast/Desktop/PowerfulMiniWeb/static;
  		# è®¾ç½®é»˜è®¤çš„indexé¡µé¢
          index  index.html;
      }
  
  }
  
  # åŠ¨æ€æ•°æ®çš„æœåŠ¡èŠ‚ç‚¹
  server {
      # è®¾ç½®ç›‘å¬çš„ç«¯å£
      listen       80;
      # è®¾ç½®æœåŠ¡å™¨åŸŸåï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸è®¾ç½®
      server_name  api.miniweb.com;
  
      # è®¾ç½®åŠ¨æ€èµ„æºçš„è·¯ç”±åŒ¹é…èŠ‚ç‚¹
      location / {
      	# uwsgiæœåŠ¡å™¨çš„é€šä¿¡åœ°å€
       	uwsgi_pass 127.0.0.1:8000;
       	# è®¾ç½®uwsgiæ¥æ”¶çš„è¯·æ±‚ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ cat /etc/nginx/uwsgi_params æŸ¥çœ‹å‚æ•°å†…å®¹
       	include uwsgi_params;
      }
  }
  ```

  ###### ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹ /etc/nginx/nginx.conf æ–‡ä»¶ include éƒ¨åˆ†çš„å†…å®¹ï¼Œæ³¨é‡Šæ‰åŸæ¥çš„åŒ…å«å…³ç³»ï¼Œå°†ä¸ºæˆ‘ä»¬é¡¹ç›®æœåŠ¡çš„é…ç½®æ–‡ä»¶è·¯å¾„æ·»åŠ è¿›æ¥ã€ç»å¯¹è·¯å¾„ï¼Œè·¯å¾„å’Œæ–‡ä»¶åä¸ä¸€å®šéå¾—å’Œè¯¾ä»¶çš„ä¸€æ ·ï¼Œåªè¦ä¿è¯æ–‡ä»¶ç¡®å®å­˜åœ¨å³å¯ã€‘

  ![image-20180728091849172](./media/work-miniFrame-images/image-20180728091849172.png)

  ###### ç¬¬å››æ­¥ï¼šé‡å¯NginxæœåŠ¡å™¨ï¼Œé€šè¿‡æµè§ˆå™¨æŸ¥çœ‹æ•ˆæœ

  ###### ç¬¬äº”æ­¥ï¼šä¿®æ”¹ä¸»æœºçš„ /etc/hosts æ–‡ä»¶ï¼Œå°†å¯¹ www.miniweb.com å’Œ api.miniweb.com çš„è¯·æ±‚æ‹¦æˆªåˆ°æœ¬åœ°

  å¦‚å›¾çš„æœ€åä¸¤è¡Œæ‰€ç¤º

  ![image-20180728091958245](./media/work-miniFrame-images/image-20180728091958245.png)

  ###### å†å°è¯•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® www.miniweb.com è¯·æ±‚é™æ€æ–‡ä»¶ã€‚

- #### ä½¿ç”¨ uWSGI æœåŠ¡å™¨ä½œä¸ºåŠ¨æ€èµ„æºçš„æœåŠ¡å™¨

  - ##### è®¤è¯† uWSGI æœåŠ¡å™¨

    ###### æ–‡æ¡£é“¾æ¥ï¼šhttp://uwsgi-docs-zh.readthedocs.io/zh_CN/latest/index.html

  - ##### å®‰è£… uWSGI æœåŠ¡å™¨

    ```shell
    # å®‰è£…å‡†å¤‡å·¥ä½œã€è¿™é‡Œå®‰è£…æ˜¯åŒæ—¶åœ¨ä¸¤ä¸ªè½¯ä»¶ï¼Œä¸æ˜¯ä¸€ä¸ªã€‘
    apt-get install build-essential python3-dev 
    # æ£€æŸ¥å½“å‰ç»ˆç«¯ pip å¯¹åº”çš„å®‰è£…ä½ç½®ï¼Œå‹¿è¦æƒ³å®‰è£…åˆ° è™šæ‹Ÿç¯å¢ƒ ä¸­å´å®‰è£…åˆ°äº† ç³»ç»Ÿç¯å¢ƒä¹‹ä¸­å»äº†
    pip -V
    # å®‰è£… uWSGI çš„ Python åŒ…ã€å…¶ä»–å®‰è£…æ–¹å¼è§æ–‡æ¡£ã€‘
    pip install uwsgi
    ```

    å®‰è£…å®Œæˆåé€šè¿‡ uwsgi å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœå‡ºç°å¤§é‡çš„å‘½ä»¤æç¤ºä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼

  - ##### å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ª uWSGI åº”ç”¨

    åˆ›å»ºä¸€ä¸ªuwsgitest .py æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹çš„å†…å®¹ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ application åº”ç”¨

    ```python
    # coding:utf-8
    from pprint import pprint
    
    """
    pprint  å¯ä»¥ç¾åŒ–ç»ˆç«¯ä¸­çš„è¾“å‡ºæ•ˆæœ
    
    uWSGIæœåŠ¡å¯åŠ¨å‘½ä»¤å¦‚æœä¸‹
    [å› ä¸ºè¦è®©NginxæœåŠ¡ä½œè½¬å‘,æ‰€ä»¥é€‰æ‹© --socket çš„å¯åŠ¨æ–¹å¼,å¦‚æœæƒ³è¦ç›´æ¥è®©æµè§ˆå™¨è®¿é—®è¯·é€‰æ‹© --http ]:
    uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py
    """
    
    
    def application(env, start_response):
        start_response('200 OK', [('Content-Type', 'text/html')])
        print('#' * 50)
        pprint(env)
        print('#' * 50)
        return [b"Hello World"]
    ```

    ###### å‘½ä»¤è¡Œå¯åŠ¨æœåŠ¡ï¼š

    æ–¹å¼ä¸€

    ã€è¯¥æ–¹å¼ä¸‹åªèƒ½é€šè¿‡Nginxè½¬å‘è¯·æ±‚æ‰èƒ½è·å–åˆ°applicationçš„å“åº”ï¼Œç›´æ¥é€šè¿‡http://127.0.0.1:8000è®¿é—®æ˜¯æ— æ•ˆçš„ã€‚å› ä¸ºåœ¨ä¹‹å‰æˆ‘ä»¬å·²ç»é…ç½®äº† Nginxçš„æœåŠ¡èŠ‚ç‚¹ å’Œ ä¿®æ”¹äº†/etc/hostsæ–‡ä»¶ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®http://api.miniweb.comæŸ¥çœ‹applicationçš„å“åº”å†…å®¹ã€‘ï¼š

    ###### uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py

    æ–¹å¼äºŒ

    ã€è¯¥æ–¹å¼ä¸‹å¯ä»¥ç›´æ¥é€šè¿‡http://127.0.0.1:8000è·å–åˆ°applicationçš„å“åº”ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡NginxæœåŠ¡å™¨çš„è½¬å‘è·å–å“åº”äº†ï¼Œå’Œæˆ‘ä»¬æƒ³è¦ç›´æ¥é€šè¿‡åŸŸåè®¿é—®çš„éœ€æ±‚ä¸ä¸€è‡´ã€‚æ‰€ä»¥ä»…ä½œäº†è§£å°±å¥½ã€‘

    ###### uwsgi --http 127.0.0.1:8000 --wsgi-file ./uwsgitest.py

    ###### æ›´å¤šå‚æ•°é€‰é¡¹

    ã€æŒ‡å®šapplicationså¯¹è±¡ "--callable app" ,å¿…é¡»å…ˆå°†uwsgitest .pyæ–‡ä»¶ä¸­çš„applicationå‡½æ•°æ›´åä¸º appã€‘

    â€‹	uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py --callable app

    ã€æ§åˆ¶å¹¶å‘ å¼€å¯å››ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹åˆåŒ…å«ä¸¤ä¸ªçº¿ç¨‹ " --processes 4 --threads 2"ã€‘

    â€‹	uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py --processes 4 --threads 2 

    ###### é€šè¿‡iniæ–‡ä»¶å¯åŠ¨æœåŠ¡

    ç¼–è¾‘å¹¶ä¿å­˜ uwsgitest.ini æ–‡ä»¶å¦‚ä¸‹ï¼Œåœ¨æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„ä¸‹ï¼Œç»ˆç«¯ä¸­è¾“å…¥ uwsgi ./uwsgitest.ini å³å¯å¯åŠ¨æœåŠ¡

    ```ini
    # å†™å…¥çš„å‚æ•°å’Œå‘½ä»¤è¡Œå¯åŠ¨éœ€è¦çš„å‚æ•°å‡ ä¹æ²¡æœ‰å·®åˆ«
    # æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„éƒ½å¯ä»¥,ä½†æ˜¯å°±å®˜æ–¹è€Œè¨€,æ›´æ¨èä½¿ç”¨ç»å¯¹è·¯å¾„
    [uwsgi]
    socket = 127.0.0.1:8000
    chdir = /home/itcast/Desktop/PowerfulMiniWeb
    wsgi-file = /home/itcast/Desktop/PowerfulMiniWeb/uwsgitest.py
    # å¹¶å‘æ§åˆ¶å¯ä»¥æ ¹æ®è‡ªå·±ç”µè„‘æƒ…å†µé€‰æ‹©,å¦‚æœä¸è®¾ç½®åˆ™ç”±uwsgiæœåŠ¡å™¨è‡ªåŠ¨åˆ¤æ–­
    # processes = 4
    # threads = 2
    ```

#### å°±è¿™æ ·éƒ¨ç½²å¥½äº†ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®äº†ï¼Œè™½ç„¶è¿™ä¸ªé¡¹ç›®å¾ˆç®€é™‹ã€‚ä½†é‡ç‚¹åœ¨äºå­¦ä¼šä½¿ç”¨è¿‡NginxæœåŠ¡å™¨å’ŒuWSGIæœåŠ¡å™¨åšé¡¹ç›®çš„éƒ¨ç½²ã€‚

------



## äºŒã€è§£å†³è·¨åŸŸè¯·æ±‚é™åˆ¶çš„ç®€å•æ–¹æ³•ï¼Œè®¤è¯†æµè§ˆå™¨çš„åŒæºç­–ç•¥

- #### ä»€ä¹ˆå«åšæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Ÿ

  å‚ç…§GitHubä¸ŠæŸä½å‰ç«¯å¤§ä½¬çš„è¯´æ³•å¦‚ä¸‹ï¼š

  https://github.com/acgotaku/WebSecurity/blob/master/docs/content/Browser_Security/Same-Origin-Policy.md#same-origin-policy

  åŒæºç­–ç•¥ï¼ˆSame Origin Policyï¼‰æ˜¯ä¸€ç§çº¦å®šï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚å¯ä»¥è¯´Webæ˜¯æ„å»ºåœ¨åŒæºç­–ç•¥çš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæµè§ˆå™¨åªæ˜¯é’ˆå¯¹åŒæºç­–ç•¥çš„ä¸€ç§å®ç°ã€‚

  **æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œé™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„â€œdocumentâ€æˆ–è„šæœ¬ï¼Œå¯¹å½“å‰â€œdocumentâ€è¯»å–æˆ–è®¾ç½®æŸäº›å±æ€§ã€‚**

  è¿™ä¸€ç­–ç•¥æ˜¯æå…¶é‡è¦çš„ï¼Œè¯•æƒ³å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥ï¼Œå¯èƒ½ a.com çš„ä¸€æ®µ JavaScript è„šæœ¬ï¼Œåœ¨ b.com æœªæ›¾åŠ è½½æ­¤è„šæœ¬æ—¶ï¼Œä¹Ÿå¯ä»¥éšæ„æ¶‚æ”¹ b.com çš„é¡µé¢ï¼ˆåœ¨æµè§ˆå™¨çš„æ˜¾ç¤ºä¸­ï¼‰ã€‚ä¸ºäº†ä¸è®©æµè§ˆå™¨çš„é¡µé¢è¡Œä¸ºå‘ç”Ÿæ··ä¹±ï¼Œæµè§ˆå™¨æå‡ºäº†â€œOriginâ€ï¼ˆæºï¼‰è¿™ä¸€æ¦‚å¿µï¼Œæ¥è‡ªä¸åŒ Originçš„å¯¹è±¡æ— æ³•äº’ç›¸å¹²æ‰°ã€‚ å¯¹äºJavaScriptæ¥è¯´ï¼Œä»¥ä¸‹æƒ…å†µè¢«è®¤ä¸ºæ˜¯åŒæºä¸ä¸åŒæºçš„ï¼š

  | URL                                       | OutCome | Reason             |
  | ----------------------------------------- | ------- | ------------------ |
  | <http://test.icehoney.me/test1.html>      | Success |                    |
  | <http://test.icehoney.me/dir1/test2.html> | Success |                    |
  | <https://test.icehoney.me/secure.html>    | Failure | Different protocol |
  | <http://test.icehoney.me:81/secure.html>  | Failure | Different port     |
  | <http://blog.icehoney.me/secure.html>     | Failure | Different host     |

  ç”±ä¸Šè¡¨å¯çŸ¥ï¼Œå½±å“â€œæºâ€çš„å› ç´ æœ‰ï¼šhostï¼ˆåŸŸåæˆ–IPåœ°å€ï¼Œå¦‚æœæ˜¯IPåœ°å€åˆ™çœ‹åšä¸€ä¸ªæ ¹åŸŸåï¼‰ã€å­åŸŸåã€ç«¯å£ã€åè®®ã€‚ 

- #### ä»åç«¯çš„è§’åº¦æ€è€ƒğŸ¤”ï¼š

  å‡ºç°è·¨åŸŸè¯·æ±‚é™åˆ¶å’Œæˆ‘ä»¬åç«¯çš„ä»£ç æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéƒ½æ˜¯æµè§ˆå™¨åœ¨åšçº¦æŸã€‚å®é™…ä¸Šè¿™ä¸ªè·¨åŸŸçš„è¯·æ±‚æˆ‘ä»¬åç«¯æœåŠ¡å™¨æ˜¯æœ‰æ¥æ”¶åˆ°çš„ï¼Œè€Œä¸”æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹ä¹Ÿé€‰æ‹©æ­£å¸¸çš„ç»™è¿™ä¸ªè¯·æ±‚è¿”å›æ•°æ®ã€‚ä½†æ˜¯ç”±äºåœ¨å“åº”å¤´ä¸­å°‘äº†ä¸€äº›ç‰¹å®šçš„å­—æ®µï¼Œæµè§ˆå™¨è®¤ä¸ºè¿™äº›å“åº”çš„æ•°æ®æ˜¯åç«¯åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¿”å›çš„ï¼Œæ²¡æœ‰çœŸæ­£ç¡®è®¤è¿™ä¸ªè¯·æ±‚çš„åˆæ³•æ€§ã€‚æ‰€ä»¥æµè§ˆå™¨è™½ç„¶æ‹¿åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯ä¸ä¼šè§£æå¹¶è¿”å›ç»™è¯·æ±‚çš„å‘é€æ–¹ï¼Œè€Œæ˜¯åœ¨æ§åˆ¶å°ä¸ŠæŠ›å‡ºä¸€ä¸ªè·¨åŸŸè¯·æ±‚çš„æƒé™é”™è¯¯æç¤ºã€‚

- #### å¯¹æ¯”æœ‰æ— è·¨åŸŸè¯·æ±‚æƒ…å†µæ—¶ï¼Œè¯·æ±‚ä¿¡æ¯çš„ä¸åŒ

  ä¿®æ”¹uwsgitest.pyçš„ä»£ç å¦‚ä¸‹,å¹¶å¯åŠ¨uwsgiæœåŠ¡å™¨ï¼š

  ```python
  # coding:utf-8
  from pprint import pprint
  
  """
  pprint  å¯ä»¥ç¾åŒ–ç»ˆç«¯ä¸­çš„è¾“å‡ºæ•ˆæœ
  
  uWSGIæœåŠ¡å¯åŠ¨å‘½ä»¤å¦‚æœä¸‹
  [å› ä¸ºè¦è®©NginxæœåŠ¡ä½œè½¬å‘,æ‰€ä»¥é€‰æ‹© --socket çš„å¯åŠ¨æ–¹å¼,å¦‚æœæƒ³è¦ç›´æ¥è®©æµè§ˆå™¨è®¿é—®è¯·é€‰æ‹© --http ]:
  uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py
  """
  
  
  def application(env, start_response):
      start_response('200 OK', [('Content-Type', 'text/html')])
      print('#' * 50)
      pprint(env)
      print('#' * 50)
      
      # é’ˆå¯¹äºéè·¨åŸŸè¯·æ±‚æ—¶æˆ‘ä»¬æš‚æ—¶æµ‹è¯•éœ€è¦æä¾›å¦‚ä¸‹çš„é™æ€èµ„æº 
      if env['PATH_INFO'] == '/':
          with open('./static/index.html', 'rb') as f:
              content = f.read()
      elif env['PATH_INFO'] == '/js/vue.min.js':
          with open('./static/js/vue.min.js', 'rb') as f:
              content = f.read()
      elif env['PATH_INFO'] == '/js/axios.min.js':
          with open('./static/js/axios.min.js', 'rb') as f:
              content = f.read()
      else:
          content = b'CORS_TEST'
      return [content]
  ```

  - ##### ä½¿ç”¨axioså‘é€GETè¯·æ±‚æ—¶ï¼Œå¯¹æ¯”å‘ç°åœ¨è¯·æ±‚å¤´ä¿¡æ¯ä¸­å¤šå‡ºäº†ä¸€ä¸ª Origin å­—æ®µä¿¡æ¯

  ```restructuredtext
  # åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://api.miniweb.com æœªå‡ºç°è·¨åŸŸè¯·æ±‚æ—¶  æµè§ˆå™¨é‡Œçš„è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ä¿¡æ¯ï¼š
  GET /xixi?name=%E8%80%81%E7%8E%8B&age=18 HTTP/1.1
  Host: api.miniweb.com
  Connection: keep-alive
  Accept: application/json, text/plain, */*
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
  Referer: http://api.miniweb.com/
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  
  # åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://www.miniweb.com å‡ºç°è·¨åŸŸè¯·æ±‚æ—¶  æµè§ˆå™¨é‡Œçš„è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ä¿¡æ¯ï¼š
  GET /xixi?name=%E8%80%81%E7%8E%8B&age=18 HTTP/1.1
  Host: api.miniweb.com
  Connection: keep-alive
  Accept: application/json, text/plain, */*
  Origin: http://www.miniweb.com
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
  Referer: http://www.miniweb.com/index.html
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  ```

  - ##### ä½¿ç”¨axioså‘é€POSTè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å‘ç°POSTè¯·æ±‚è«åå¥‡å¦™çš„å˜æˆäº†OPTIONSè¯·æ±‚ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨å‘ç°æ˜¯è·¨åŸŸçš„POSTè¯·æ±‚åä¼šå…ˆå‘é€ä¸€ä¸ªOPTIONSè¯·æ±‚è¿›è¡Œé¢„æ£€ï¼Œç¡®è®¤æœåŠ¡å™¨çš„å“åº”ä¿¡æ¯ä¸­å…è®¸è¯¥è¯·æ±‚æ—¶æ‰ä¼šå†æ¬¡çœŸæ­£çš„è¿”é€POSTè¯·æ±‚ã€‚å…ˆä¸ç®¡çœŸæ­£çš„POSTè¯·æ±‚ï¼Œå¯¹æ¯”å‘ç°åœ¨è¯·æ±‚å¤´ä¿¡æ¯ä¸­å¤šå‡ºäº† Access-Control-Request-XXX ç­‰å­—æ®µä¿¡æ¯ã€‚è¯´æ˜åœ¨è·¨åŸŸè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šä¸»åŠ¨çš„å°†ä¸€äº›ç‰¹æ®Šä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ã€‚

  ```restructuredtext
  # åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://api.miniweb.comæœªå‡ºç°è·¨åŸŸè¯·æ±‚æ—¶  æµè§ˆå™¨é‡Œçš„è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ä¿¡æ¯ï¼š
  POST /nihao HTTP/1.1
  Host: api.miniweb.com
  Connection: keep-alive
  Content-Length: 15
  Accept: application/json, text/plain, */*
  Origin: http://api.miniweb.com
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
  Content-Type: application/json;charset=UTF-8
  Referer: http://api.miniweb.com/
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  
  # åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://www.miniweb.com å‡ºç°è·¨åŸŸè¯·æ±‚æ—¶  æµè§ˆå™¨é‡Œçš„è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ä¿¡æ¯ï¼š
  OPTIONS /nihao HTTP/1.1
  Host: api.miniweb.com
  Connection: keep-alive
  Access-Control-Request-Method: POST
  Origin: http://www.miniweb.com
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36
  Access-Control-Request-Headers: content-type
  Accept: */*
  Accept-Encoding: gzip, deflate
  Accept-Language: zh-CN,zh;q=0.9
  ```

- #### å¦‚ä½•é€šè¿‡æ·»åŠ å“åº”å¤´å°±ç›´æ¥è§£å†³è·¨åŸŸè¯·æ±‚é™åˆ¶çš„é—®é¢˜ï¼Ÿ

  å­¦ä¹ HTTPåè®®çš„æ¨èæ–‡æ¡£ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP

- ##### HTTPè®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰ä¹‹HTTP å“åº”é¦–éƒ¨å­—æ®µ

  ### Access-Control-Allow-Origin

  å“åº”é¦–éƒ¨ä¸­å¯ä»¥æºå¸¦ä¸€ä¸ª `Access-Control-Allow-Origin` å­—æ®µï¼Œå…¶è¯­æ³•å¦‚ä¸‹:`

  ```
  Access-Control-Allow-Origin: <origin> | *
  ```

  å…¶ä¸­ï¼Œorigin å‚æ•°çš„å€¼æŒ‡å®šäº†å…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸ URIã€‚å¯¹äºä¸éœ€è¦æºå¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒ‡å®šè¯¥å­—æ®µçš„å€¼ä¸ºé€šé…ç¬¦ï¼Œè¡¨ç¤ºå…è®¸æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚

  ä¾‹å¦‚ï¼Œä¸‹é¢çš„å­—æ®µå€¼å°†å…è®¸æ¥è‡ª http://mozilla.com çš„è¯·æ±‚ï¼š

  ```
  Access-Control-Allow-Origin: http://mozilla.com
  ```

  å¦‚æœæœåŠ¡ç«¯æŒ‡å®šäº†å…·ä½“çš„åŸŸåè€Œéâ€œ*â€ï¼Œé‚£ä¹ˆå“åº”é¦–éƒ¨ä¸­çš„ Vary å­—æ®µçš„å€¼å¿…é¡»åŒ…å« Originã€‚è¿™å°†å‘Šè¯‰å®¢æˆ·ç«¯ï¼šæœåŠ¡å™¨å¯¹ä¸åŒçš„æºç«™è¿”å›ä¸åŒçš„å†…å®¹ã€‚

  ### Access-Control-Expose-Headers

  åœ¨è·¨åŸŸè®¿é—®æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°ä¸€äº›æœ€åŸºæœ¬çš„å“åº”å¤´ï¼ŒCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–å¤´ï¼Œåˆ™éœ€è¦æœåŠ¡å™¨è®¾ç½®æœ¬å“åº”å¤´ã€‚

  `Access-Control-Expose-Headers`å¤´è®©æœåŠ¡å™¨æŠŠå…è®¸æµè§ˆå™¨è®¿é—®çš„å¤´æ”¾å…¥ç™½åå•ï¼Œä¾‹å¦‚ï¼š

  ```
  Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header
  ```

  è¿™æ ·æµè§ˆå™¨å°±èƒ½å¤Ÿé€šè¿‡getResponseHeaderè®¿é—®`X-My-Custom-Header`å’Œ `X-Another-Custom-Header` å“åº”å¤´äº†ã€‚

  ### Access-Control-Max-Age

  `Access-Control-Max-Age`å¤´æŒ‡å®šäº†preflightè¯·æ±‚çš„ç»“æœèƒ½å¤Ÿè¢«ç¼“å­˜å¤šä¹…ï¼Œè¯·å‚è€ƒæœ¬æ–‡åœ¨å‰é¢æåˆ°çš„preflightä¾‹å­ã€‚

  ```
  Access-Control-Max-Age: <delta-seconds>
  ```

  `delta-seconds` å‚æ•°è¡¨ç¤ºpreflightè¯·æ±‚çš„ç»“æœåœ¨å¤šå°‘ç§’å†…æœ‰æ•ˆã€‚

  ### Access-Control-Allow-Credentials

  `Access-Control-Allow-Credentials`å¤´æŒ‡å®šäº†å½“æµè§ˆå™¨çš„`credentials`è®¾ç½®ä¸ºtrueæ—¶æ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å–responseçš„å†…å®¹ã€‚å½“ç”¨åœ¨å¯¹preflighté¢„æ£€æµ‹è¯·æ±‚çš„å“åº”ä¸­æ—¶ï¼Œå®ƒæŒ‡å®šäº†å®é™…çš„è¯·æ±‚æ˜¯å¦å¯ä»¥ä½¿ç”¨`credentials`ã€‚

  è¯·æ³¨æ„ï¼šç®€å• GET è¯·æ±‚ä¸ä¼šè¢«é¢„æ£€ï¼›å¦‚æœå¯¹æ­¤ç±»è¯·æ±‚çš„å“åº”ä¸­ä¸åŒ…å«è¯¥å­—æ®µï¼Œè¿™ä¸ªå“åº”å°†è¢«å¿½ç•¥æ‰ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¹Ÿä¸ä¼šå°†ç›¸åº”å†…å®¹è¿”å›ç»™ç½‘é¡µã€‚

  ```
  Access-Control-Allow-Credentials: true
  ```

  ### Access-Control-Allow-Methods

  `Access-Control-Allow-Methods`é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚æ‰€å…è®¸ä½¿ç”¨çš„ HTTP æ–¹æ³•ã€‚

  ```
  Access-Control-Allow-Methods: <method>[, <method>]*
  ```

  ### Access-Control-Allow-Headers

  `Access-Control-Allow-Headers`é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„é¦–éƒ¨å­—æ®µã€‚

  ```
  Access-Control-Allow-Headers: <field-name>[, <field-name>]*
  ```

- ##### äº†è§£äº†è¿™ä¹ˆå¤šæˆ‘ä»¬å»å®é™…ä½¿ç”¨ä¸€ä¸‹

  ä¿®æ”¹uwsgitest.pyçš„ä»£ç å¦‚ä¸‹ï¼š

  ```python
  # coding:utf-8
  from pprint import pprint
  
  """
  pprint  å¯ä»¥ç¾åŒ–ç»ˆç«¯ä¸­çš„è¾“å‡ºæ•ˆæœ
  
  uWSGIæœåŠ¡å¯åŠ¨å‘½ä»¤å¦‚æœä¸‹
  [å› ä¸ºè¦è®©NginxæœåŠ¡ä½œè½¬å‘,æ‰€ä»¥é€‰æ‹© --socket çš„å¯åŠ¨æ–¹å¼,å¦‚æœæƒ³è¦ç›´æ¥è®©æµè§ˆå™¨è®¿é—®è¯·é€‰æ‹© --http ]:
  uwsgi --socket 127.0.0.1:8000 --wsgi-file ./uwsgitest.py
  """
  allow_host = 'http://www.miniweb.com'
  
  def application(env, start_response):
      response_line = '200 OK'
      response_headers = [('Content-Type', 'text/html')]
  	
      # æ‰“å°æœåŠ¡å™¨æä¾›ç»™æ¡†æ¶çš„è¯·æ±‚ä¿¡æ¯
      print('#' * 20)
      pprint(env)
      # print('@'*20)
      # # é’ˆå¯¹æ”¾åœ¨è¯·æ±‚ä½“ä¸­çš„æ•°æ®éœ€è¦é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–ï¼Œå¹¶ä¸”å¾—åˆ°çš„æ•°æ®æ—¶bytesç±»å‹
      # input_ob = env['wsgi.input']
      # pprint(dir(input_ob))
      # pprint(input_ob.read())
      print('#' * 20)
  
      # å¯¹äºGETè¯·æ±‚,åœ¨æœ‰è·¨äºè¯·æ±‚çš„æƒ…å†µä¸‹,envå­—å…¸ä¸­ä¼šå¤šå¤„ä¸€ä¸ªé”®'HTTP_ORIGIN'
      if (env['REQUEST_METHOD'] == 'GET') and ('HTTP_ORIGIN' in env.keys()):
          extra_headers = [
              ('Access-Control-Allow-Origin', allow_host),
              ('Access-Control-Allow-Credentials', 'true'),
          	('Set-Cookie', 'name=laowang; max-age=86400; domain=.miniweb.com; path=/'),
              ('Set-Cookie', 'name2=dazhu; max-age=86400; domain=.miniweb.com; path=/')
          ]
          response_headers.extend(extra_headers)
  
      # å¯¹äºOPTIONSè¿™ä¸ªé¢„æ£€è¯·æ±‚,çš„å¤„ç†å¦‚ä¸‹
      if env['REQUEST_METHOD'] == 'OPTIONS':
          extra_headers = [
              ('Access-Control-Allow-Origin', allow_host),
              ('Access-Control-Allow-Credentials', 'true'),
              ('Access-Control-Allow-Methods', 'OPTIONS,POST'),
              ('Access-Control-Allow-Headers', 'Content-Type')
          ]
          response_headers.extend(extra_headers)
      # å¯¹äºPOSTè¯·æ±‚, è·¨åŸŸæ—¶ é”®'HTTP_ORIGIN' å¯¹åº”çš„å€¼ä¸ºè¯·æ±‚å‘é€æ–¹çš„åŸŸååœ°å€
      if env['REQUEST_METHOD'] == 'POST'and (env['HTTP_ORIGIN'] == allow_host):
          extra_headers = [
              ('Access-Control-Allow-Origin', allow_host),
              ('Access-Control-Allow-Credentials', 'true'),
              # ('Access-Control-Allow-Methods', 'OPTIONS,POST'),
              # ('Access-Control-Allow-Headers', 'Content-Type')
          ]
          response_headers.extend(extra_headers)
  
      # å¤„ç†éè·¨åŸŸæ—¶çš„é™æ€èµ„æºé—®é¢˜
      if env['PATH_INFO'] == '/':
          with open('./static/index.html', 'rb') as f:
              content = f.read()
      elif env['PATH_INFO'] == '/js/vue.min.js':
          with open('./static/js/vue.min.js', 'rb') as f:
              content = f.read()
      elif env['PATH_INFO'] == '/js/axios.min.js':
          with open('./static/js/axios.min.js', 'rb') as f:
              content = f.read()
      else:
          content = b'CORS_TEST'
  
      # è®¾ç½®å“åº”è¡Œå’Œå“åº”å¤´ä¿¡æ¯
      start_response(response_line, response_headers)
      return [content]
  
  ```

  #### æ€»ç»“ï¼š

  #### åœ¨å¤„ç†è·¨åŸŸè¯·æ±‚æ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯è·¨åŸŸè€Œæ¥çš„ï¼Œå¦‚æœæ˜¯å†æ ¹æ®è¯·æ±‚æ–¹å¼å¾€å“åº”å¤´é‡Œæ·»åŠ å‘ŠçŸ¥æµè§ˆå™¨å…è®¸è·¨åŸŸè¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚

  #### é’ˆå¯¹è·¨åŸŸè€Œæ¥çš„GETæˆ–POSTè¯·æ±‚ï¼Œå¿…éœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ ï¼š

  #### `Access-Control-Allow-Origin`ã€`Access-Control-Allow-Credentials`

  #### è€Œé’ˆå¯¹ç‰¹æ®Šçš„OPTIONSé¢„æ£€è¯·æ±‚ï¼Œå¿…éœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ ï¼š

  #### `Access-Control-Allow-Origin`ã€`Access-Control-Allow-Credentials`

  #### `Access-Control-Allow-Methods`ã€`Access-Control-Allow-Headers`

------



## ä¸‰ã€äº†è§£ORMæ¨¡å—æ˜¯å¦‚ä½•é€šè¿‡æ¨¡å‹ç±»è·å–åˆ°æ•°æ®è¡¨å­—æ®µä¿¡æ¯çš„

- #### Pythonä¸­çš„ `å…ƒç±»` æ˜¯ä»€ä¹ˆï¼Ÿ

  å…ƒç±»åˆ¶å®šç±»çš„åˆ›å»ºè¡Œä¸ºï¼Œå¯¹äºå…ƒç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºç”¨æ¥åˆ›å»ºç±»çš„ç±»ã€‚

  åœ¨Pythonä¸­ä½¿ç”¨ class å…³é”®å­—å®šä¹‰ç±»æ—¶ï¼Œå½“ç±»è¢«åˆ›å»ºçš„æ—¶å€™ä¼šæœå¯»æ‰€æœ‰çš„çˆ¶ç±»æ˜¯å¦æœ‰æŒ‡å®šçš„å‚æ•°mateclassï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤çš„å…ƒç±»:  typeï¼Œå¦‚æœåœ¨æŸä¸ªçˆ¶ç±»ä¸­æ‰¾åˆ°äº†æŒ‡å®šçš„mateclassï¼Œåˆ™ä½¿ç”¨è¯¥å…ƒç±»æ¥åˆ›å»ºç±»ã€‚

  å®é™…ä¸ŠPythonä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯å…ƒç±»typeåˆ›å»ºçš„ï¼Œå› ä¸ºä½ è‡ªå·±å®šä¹‰çš„mateclassä¹Ÿæ˜¯å¿…é¡»è¦ç»§æ‰¿äºtypeã€‚

  ![image-20180728094941376](./media/work-miniFrame-images/image-20180728094941376.png)

- #### åˆ›å»ºç±»çš„ä¸¤ç§æ–¹å¼

  ```python
  # coding:utf-8
  
  # ç¬¬ä¸€ç§ï¼Œä½¿ç”¨classå…³é”®å­—å®šä¹‰ä¸€ä¸ªç±»,è¿™ç§æ–¹å¼çš„å®é™…å®šä¹‰æ˜¯ï¼š
  # class TestClass(object, metaclass=type)
  class TestClass01:
      name = 'TestClass01'
  
      def hello(self):
          print('hello:', self.name)
  
  
  # ç¬¬äºŒç§ï¼Œä½¿ç”¨typeå¯¹è±¡åˆ›å»ºä¸€ä¸ªçš„ç±»
  # å‚æ•°åˆ†åˆ«æ˜¯ ç±»åï¼Œçˆ¶ç±»é›†åˆï¼Œå±æ€§å’Œæ–¹æ³•çš„å­—å…¸
  def say_hello(self):
      print('say hello:', self.name)
  
  
  name = 'TestClass02'
  
  TestClass02 = type(name, (object,), {'name': name, 'say_hello': say_hello})
  
  print(TestClass01, '\t', TestClass01(), '\t', TestClass01.name)
  TestClass01().hello()
  print('#' * 20)
  print(TestClass02, '\t', TestClass02(), '\t', TestClass02.name)
  TestClass02().say_hello()
  
  ```

- #### é€šè¿‡æŒ‡å®šçˆ¶ç±»çš„`metaclass`å‚æ•°ï¼Œå®ç°è‡ªå®šä¹‰metaclassè‡ªåŠ¨æ³¨å†Œå…¶åˆ›å»ºçš„ç±»

  åœ¨æ¡†æ¶çš„ORMæ˜ å°„çš„å­¦ä¹ ä¸­ï¼ŒåŒå­¦é€šå¸¸æœ‰ä¸€ä¸ªç–‘é—®ğŸ¤”ï¸ï¼Œé‚£å°±æ˜¯åšæ¨¡å‹ç±»è¿ç§»åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå‡ºç›¸åº”çš„æ•°æ®è¡¨çš„æ—¶å€™ï¼ŒORMæ¨¡å—æ˜¯å¦‚ä½•æ‹¿åˆ°æˆ‘ä»¬å®šä¹‰çš„é‚£äº›å­—æ®µä¿¡æ¯çš„ï¼Ÿä¾‹å¦‚ä¸‹é¢çš„æ¨¡å‹ç±»ä»£ç ï¼š

  ![image-20180728112553040](./media/work-miniFrame-images/image-20180728112553040.png)

  è¿™é‡Œçš„ç–‘é—®å°±æ˜¯ï¼šæ¨¡å‹ç±»è¿ç§»æ—¶æ˜¯å¦‚ä½•æ‹¿åˆ°UserInfoç±»ä¸‹çš„idã€avatarã€nick_name..ç­‰è¿™äº›ç±»å±æ€§çš„ä¿¡æ¯çš„ï¼Ÿæˆ‘ä»¬å¥½åƒå¹¶æ²¡æœ‰åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œä¹Ÿæ²¡æœ‰è‡ªå·±é€šè¿‡ç±»å¯¹è±¡æ‰‹åŠ¨å»è·å–è¿™äº›ç±»å±æ€§ã€‚

  ###### æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä»£ç å®ç°ä¸€ä¸ªåœºæ™¯â€”â€”`é€šè¿‡è‡ªå®šä¹‰å…ƒç±»çš„å±æ€§è·å–åˆ°æ‰€ä»¥é€šè¿‡è¿™ä¸ªå…ƒç±»åˆ›å»ºçš„ç±»çš„ä¿¡æ¯`

  ```python
  # coding:utf-8
  
  # ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„metaclassï¼Œç”¨æ¥åˆ›å»ºæˆ‘ä»¬è‡ªå®šä¹‰çš„åŸºç±»å’ŒåŸºç±»çš„å­ç±»
  class MyMetaClass(type):
      # ç”¨æ¥è®°å½•æˆ‘ä»¬è‡ªå®šä¹‰çˆ¶ç±»çš„æ‰€æœ‰å­ç±»åˆ—è¡¨
      record_cls = []
  
      # é‡å†™__new__æ–¹æ³•ï¼Œåœ¨åˆ›å»ºå¥½ç±»åï¼Œå¦‚æœè¿™ä¸ªç±»å¯¹è±¡ä¸æ˜¯æˆ‘ä»¬çš„çˆ¶ç±»åˆ™å°†è¿™ä¸ªå­ç±»è®°å½•ä¸‹æ¥
      def __new__(cls, name, bases, attrs):
          new_cls = type.__new__(cls, name, bases, attrs)
          if name != 'BaseClass':
              MyMetaClass.record_cls.append(new_cls)
          return new_cls
  
  
  # ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„çˆ¶ç±»BaseClassï¼Œè®©åç»­åˆ›å»ºçš„å­ç±»éƒ½ç»§æ‰¿äºå®ƒ
  # å¹¶ä¸”æŒ‡å®šè¿™ä¸ªçˆ¶ç±»BaseClassçš„ metaclass å‚æ•°çš„å€¼ä¸º MyMateClass
  class BaseClass(object, metaclass=MyMetaClass):
      pass
  
  
  class Foo01(BaseClass):
      name = 'Foo01'
      pass
  
  
  class Foo02(BaseClass):
      name = 'Foo02'
      pass
  
  
  # è¿­ä»£è®°å½•åˆ—è¡¨é‡Œçš„ç±»ï¼Œæ‰“å°ç±»çš„ä¿¡æ¯
  for cls in MyMetaClass.record_cls:
      print(cls, '\t', cls.name, '\t', type(cls))
      
  ```

  ##### ä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè®°å½•äº†æ‰€æœ‰åˆ›å»ºå­ç±»çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¤§æ¦‚çŸ¥é“`ORMæ¨¡å—`æ˜¯å¦‚ä½•è·å–æˆ‘ä»¬å®šä¹‰çš„æ¨¡å‹ç±»é‡Œçš„å­—æ®µå±æ€§ä¿¡æ¯äº†å§âœŒï¸ï¼š

  ![image-20180728151253393](./media/work-miniFrame-images/image-20180728151253393.png)

------



## å››ã€åŸºäºuWSGIæœåŠ¡å™¨å’ŒWSGIåè®®æ„å»ºä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹è¾ƒä¸ºé½å…¨çš„WEBæ¡†æ¶

- #### è®¾è®¡æ¡†æ¶é¡¹ç›®çš„æ¨¡å—ã€æ–‡ä»¶ã€‘ç»“æ„

  - ###### æ–‡ä»¶ç»“æ„å›¾

  ![image-20180808195405948](./media/work-miniFrame-images/image-20180808195405948.png)

  - å„æ–‡ä»¶ã€æ¨¡å—ã€‘éœ€è¦å®ç°çš„åŠŸèƒ½
    - `core.py`			æ¡†æ¶æ ¸å¿ƒï¼Œç”¨æ¥åˆ›å»ºapplicationå¯¹è±¡å’ŒuwsgiæœåŠ¡å™¨äº¤äº’
      `http/__init__.py`    	ä¿å­˜ä¸€äº›å’Œå¤„ç†è¯·æ±‚ç›¸å…³çš„å¸¸é‡
       `http/request.py` 	ä¿å­˜æ„å»ºè¯·æ±‚ä½“çš„åŸºç±»
       `http/response.py`	ä¿å­˜æ„å»ºå“åº”ä½“çš„åŸºç±»
       `http/url`			ä¿å­˜æ„å»ºè·¯ç”±å¯¹è±¡çš„åŸºç±»å’Œåˆ›å»ºè·¯ç”±å¯¹è±¡çš„å‡½æ•°
       `middleware.py`		ä¿å­˜æ„å»ºä¸­é—´ä»¶çš„åŸºç±»
       `script.py`			ä¿å­˜æ¨¡å—å®‰è£…åçš„shellå‘½ä»¤æ‰§è¡Œå†…å®¹
       `utils.py`			ä¿å­˜sessionå·¥å…·ç±»å’Œç”¨æ¥åˆ›å»ºä¸­é—´ä»¶ç±»çš„å…ƒç±»
       `view.py`			ä¿å­˜ç±»è§†å›¾åŸºç±»

- #### è®¤è¯†uWSGIæœåŠ¡å™¨å‘æ¡†æ¶æä¾›çš„ä¿¡æ¯æœ‰å“ªäº›ï¼Ÿ

  ###### éè·¨åŸŸè¯·æ±‚æ—¶ï¼š

  - GET

    ```
    {'CONTENT_LENGTH': '',
     'CONTENT_TYPE': '',
     'DOCUMENT_ROOT': '/usr/share/nginx/html',
     'HTTP_ACCEPT': 'application/json, text/plain, */*',
     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
     'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.9',
     'HTTP_CONNECTION': 'keep-alive',
     'HTTP_COOKIE': 'name=laowang; name2=dazhu',  # å¦‚æœæœåŠ¡å™¨åœ¨ä¹‹å‰å“åº”ä¸­æœªè®¾ç½®ï¼Œåˆ™æ²¡æœ‰
     'HTTP_HOST': 'api.miniweb.com',
     'HTTP_REFERER': 'http://api.miniweb.com/',
     'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
     'PATH_INFO': '/GetTest',
     'QUERY_STRING': 'name=%E8%80%81%E7%8E%8B&age=18',
     'REMOTE_ADDR': '127.0.0.1',
     'REMOTE_PORT': '51732',
     'REQUEST_METHOD': 'GET',
     'REQUEST_SCHEME': 'http',
     'REQUEST_URI': '/GetTest?name=%E8%80%81%E7%8E%8B&age=18',
     'SERVER_NAME': 'api.miniweb.com',
     'SERVER_PORT': '80',
     'SERVER_PROTOCOL': 'HTTP/1.1',
     'uwsgi.node': b'ubuntu',
     'uwsgi.version': b'2.0.17.1',
     'wsgi.errors': <_io.TextIOWrapper name=2 mode='w' encoding='UTF-8'>,
     'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,
     'wsgi.input': <uwsgi._Input object at 0x7fb4d73498a0>,
     'wsgi.multiprocess': False,
     'wsgi.multithread': False,
     'wsgi.run_once': False,
     'wsgi.url_scheme': 'http',
     'wsgi.version': (1, 0)}
    ```

  - POST

    ```
    {'CONTENT_LENGTH': '15',
     'CONTENT_TYPE': 'application/json;charset=UTF-8',
     'DOCUMENT_ROOT': '/usr/share/nginx/html',
     'HTTP_ACCEPT': 'application/json, text/plain, */*',
     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
     'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.9',
     'HTTP_CONNECTION': 'keep-alive',
     'HTTP_CONTENT_LENGTH': '15',
     'HTTP_CONTENT_TYPE': 'application/json;charset=UTF-8',
     'HTTP_COOKIE': 'name=laowang; name2=dazhu',  # å¦‚æœæœåŠ¡å™¨åœ¨ä¹‹å‰å“åº”ä¸­æœªè®¾ç½®ï¼Œåˆ™æ²¡æœ‰
     'HTTP_HOST': 'api.miniweb.com',
     'HTTP_ORIGIN': 'http://api.miniweb.com',
     'HTTP_REFERER': 'http://api.miniweb.com/',
     'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
     'PATH_INFO': '/PostTest',
     'QUERY_STRING': '',
     'REMOTE_ADDR': '127.0.0.1',
     'REMOTE_PORT': '51732',
     'REQUEST_METHOD': 'POST',
     'REQUEST_SCHEME': 'http',
     'REQUEST_URI': '/PostTest',
     'SERVER_NAME': 'api.miniweb.com',
     'SERVER_PORT': '80',
     'SERVER_PROTOCOL': 'HTTP/1.1',
     'uwsgi.node': b'ubuntu',
     'uwsgi.version': b'2.0.17.1',
     'wsgi.errors': <_io.TextIOWrapper name=2 mode='w' encoding='UTF-8'>,
     'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,
     'wsgi.input': <uwsgi._Input object at 0x7fb4d73498a0>,
     'wsgi.multiprocess': False,
     'wsgi.multithread': False,
     'wsgi.run_once': False,
     'wsgi.url_scheme': 'http',
     'wsgi.version': (1, 0)}
    ```

  ###### è·¨åŸŸè¯·æ±‚æ—¶ï¼š

  - GET

    ```
    {'CONTENT_LENGTH': '',
     'CONTENT_TYPE': '',
     'DOCUMENT_ROOT': '/usr/share/nginx/html',
     'HTTP_ACCEPT': 'application/json, text/plain, */*',
     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
     'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.9',
     'HTTP_CONNECTION': 'keep-alive',
     'HTTP_COOKIE': 'name=laowang; name2=dazhu'	 # å¦‚æœæœåŠ¡å™¨åœ¨ä¹‹å‰å“åº”ä¸­æœªè®¾ç½®ï¼Œåˆ™æ²¡æœ‰
     'HTTP_HOST': 'api.miniweb.com',
     'HTTP_ORIGIN': 'http://www.miniweb.com',
     'HTTP_REFERER': 'http://www.miniweb.com/index.html',
     'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
     'PATH_INFO': '/GetTest',
     'QUERY_STRING': 'name=%E8%80%81%E7%8E%8B&age=18',
     'REMOTE_ADDR': '127.0.0.1',
     'REMOTE_PORT': '51758',
     'REQUEST_METHOD': 'GET',
     'REQUEST_SCHEME': 'http',
     'REQUEST_URI': '/GetTest?name=%E8%80%81%E7%8E%8B&age=18',
     'SERVER_NAME': 'api.miniweb.com',
     'SERVER_PORT': '80',
     'SERVER_PROTOCOL': 'HTTP/1.1',
     'uwsgi.node': b'ubuntu',
     'uwsgi.version': b'2.0.17.1',
     'wsgi.errors': <_io.TextIOWrapper name=2 mode='w' encoding='UTF-8'>,
     'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,
     'wsgi.input': <uwsgi._Input object at 0x7f5621cf88a0>,
     'wsgi.multiprocess': False,
     'wsgi.multithread': False,
     'wsgi.run_once': False,
     'wsgi.url_scheme': 'http',
     'wsgi.version': (1, 0)}
    ```

  - OPTIONS

    ```
    {'CONTENT_LENGTH': '',
     'CONTENT_TYPE': '',
     'DOCUMENT_ROOT': '/usr/share/nginx/html',
     'HTTP_ACCEPT': '*/*',
     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
     'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.9',
     'HTTP_ACCESS_CONTROL_REQUEST_HEADERS': 'content-type',
     'HTTP_ACCESS_CONTROL_REQUEST_METHOD': 'POST',
     'HTTP_CONNECTION': 'keep-alive',
     'HTTP_HOST': 'api.miniweb.com',
     'HTTP_ORIGIN': 'http://www.miniweb.com',
     'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
     'PATH_INFO': '/PostTest',
     'QUERY_STRING': '',
     'REMOTE_ADDR': '127.0.0.1',
     'REMOTE_PORT': '51772',
     'REQUEST_METHOD': 'OPTIONS',
     'REQUEST_SCHEME': 'http',
     'REQUEST_URI': '/PostTest',
     'SERVER_NAME': 'api.miniweb.com',
     'SERVER_PORT': '80',
     'SERVER_PROTOCOL': 'HTTP/1.1',
     'uwsgi.node': b'ubuntu',
     'uwsgi.version': b'2.0.17.1',
     'wsgi.errors': <_io.TextIOWrapper name=2 mode='w' encoding='UTF-8'>,
     'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,
     'wsgi.input': <uwsgi._Input object at 0x7f5621cf88a0>,
     'wsgi.multiprocess': False,
     'wsgi.multithread': False,
     'wsgi.run_once': False,
     'wsgi.url_scheme': 'http',
     'wsgi.version': (1, 0)}
    ```

  - POST

    ```
    {'CONTENT_LENGTH': '15',
     'CONTENT_TYPE': 'application/json;charset=UTF-8',
     'DOCUMENT_ROOT': '/usr/share/nginx/html',
     'HTTP_ACCEPT': 'application/json, text/plain, */*',
     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
     'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.9',
     'HTTP_CONNECTION': 'keep-alive',
     'HTTP_CONTENT_LENGTH': '15',
     'HTTP_CONTENT_TYPE': 'application/json;charset=UTF-8',
     'HTTP_COOKIE': 'name=laowang; name2=dazhu'	 # å¦‚æœæœåŠ¡å™¨åœ¨ä¹‹å‰å“åº”ä¸­æœªè®¾ç½®ï¼Œåˆ™æ²¡æœ‰
     'HTTP_HOST': 'api.miniweb.com',
     'HTTP_ORIGIN': 'http://www.miniweb.com',
     'HTTP_REFERER': 'http://www.miniweb.com/index.html',
     'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
     'PATH_INFO': '/PostTest',
     'QUERY_STRING': '',
     'REMOTE_ADDR': '127.0.0.1',
     'REMOTE_PORT': '51758',
     'REQUEST_METHOD': 'POST',
     'REQUEST_SCHEME': 'http',
     'REQUEST_URI': '/PostTest',
     'SERVER_NAME': 'api.miniweb.com',
     'SERVER_PORT': '80',
     'SERVER_PROTOCOL': 'HTTP/1.1',
     'uwsgi.node': b'ubuntu',
     'uwsgi.version': b'2.0.17.1',
     'wsgi.errors': <_io.TextIOWrapper name=2 mode='w' encoding='UTF-8'>,
     'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,
     'wsgi.input': <uwsgi._Input object at 0x7f5621cf88a0>,
     'wsgi.multiprocess': False,
     'wsgi.multithread': False,
     'wsgi.run_once': False,
     'wsgi.url_scheme': 'http',
     'wsgi.version': (1, 0)}
    ```

  ###### æ€»ç»“ï¼š

  - å…³äºenvironçš„å†…å®¹çš„æ€»ç»“
    - å’ŒHTTPåè®®`è¯·æ±‚å¤´`æœ‰å…³çš„ä¿¡æ¯çš„é”®éƒ½ä»¥"HTTP"å¼€å¤´
    - å’Œè¯·æ±‚æ–¹å¼åŠå‚æ•°åŠå®¢æˆ·ç«¯çš„æœ‰å…³çš„ä¿¡æ¯çš„é”®æœ‰`[REQUEST_METHOD, PAHT_INFO, QUERY_SRTING,REQUEST_URI,REMOTE_ADDR]`
    - å’ŒæœåŠ¡å™¨ä¿¡æ¯æœ‰å…³çš„é”®æœ‰`[SERVER_NAME, SERVER_PORT,SERVER_PROTOCOL,uwsgi.node,uwsgi.version,]`
    - è¯·æ±‚ä½“ä¿¡æ¯éœ€è¦é€šè¿‡é”® `wsgi.input`å¯¹åº”çš„å¯¹è±¡çš„read()æ–¹æ³•æå–
    - å…¶ä»–æ›´å¤šçš„é”®å¯¹åº”çš„å†…å®¹æš‚æ—¶ä¸åšç ”ç©¶
  - å…³äºéè·¨åŸŸä¸è·¨åŸŸæ—¶è¯·æ±‚å¤´å·®å¼‚çš„æ€»ç»“
    - è¾¨åˆ«æ˜¯å¦ä¸ºè·¨åŸŸè¯·æ±‚å¯ä»¥é€šè¿‡ï¼š'HTTP_ORIGIN'å’Œ'HTTP_REFERER'  è¿™ä¸¤ä¸ªé”®çš„å€¼å»åˆ¤æ–­
    - é’ˆå¯¹è·¨åŸŸé¢„æ£€è¯·æ±‚OPTIONSï¼Œå¯ä»¥é€šè¿‡ï¼š'HTTP_ACCESS_CONTROL_REQUEST_HEADERS' å’Œ 'HTTP_ACCESS_CONTROL_REQUEST_METHOD'  è¿™ä¸¤ä¸ªé”®è·å–æ›´å¤šçš„ä¿¡æ¯ï¼Œå¹¶æä¾›ç›¸åº”çš„å“åº”å¤´å†…å®¹

- #### ä¾æ®æœåŠ¡å™¨æä¾›ç»™æ¡†æ¶çš„è¯·æ±‚ä¿¡æ¯å†…å®¹æ„å»ºæˆ‘ä»¬æ¡†æ¶çš„requestå¯¹è±¡çš„ç±»å’Œsessionå¯¹è±¡çš„ç±»

  - ###### requestå¯¹è±¡çš„ç±»ï¼Œå†™åœ¨request.py æ–‡ä»¶ä¸­

  ```python
  # coding:utf-8
  import json
  from urllib import parse
  
  DATA_ERROR_TIP = {
      "error": "Sorry,The miniFrame only support analysis request body data with 'application/json;charset=utf-8' type at present"
  }
  
  
  class BaseRequest:
      """
      è¯·æ±‚ä½“ç±»,æ ¹æ®ä»æœåŠ¡å™¨è·å–çš„è¯·æ±‚ä¿¡æ¯æ„å»ºè¯·æ±‚ä½“å¯¹è±¡
      """
  
      def __init__(self, env):
          """
          åˆå§‹åŒ–è¯·æ±‚ä½“,ä¿å­˜ä»æœåŠ¡å™¨è·å–çš„è¯·æ±‚ä¿¡æ¯,å¹¶é¢„å…ˆç•™å‡ºä¸€äº›ä¿å­˜å…¶ä»–æ•°æ®çš„å®ä¾‹å±æ€§
          :param env: ä»æœåŠ¡å™¨è·å–çš„è¯·æ±‚ä¿¡æ¯
          path_data   [é¢„ç•™]ä¿å­˜ä»è·¯å¾„ä¸­è·å–çš„å‚æ•°é”®å€¼å¯¹
          set_cookie   [é¢„ç•™]ä¿å­˜è§†å›¾ä¸­è®¾ç½®çš„COOKIEä¿¡æ¯
          session     [é¢„ç•™]ä¿å­˜å’ŒæŸ¥è¯¢å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„SESSIONä¿¡æ¯,ä¿å­˜æ—¶ä¼šåŒæ—¶å‘set_cookieä¸­æ·»åŠ session_idçš„é”®å€¼å¯¹
          """
          self.environ = env
          self.path_data = dict()
          self.set_cookies_list = list()
          self.session = None
  
      def __query_string_data(self):
          """
          è·å–æŸ¥è¯¢å­—ç¬¦é‡Œçš„è¯·æ±‚å‚æ•°é”®å€¼å¯¹
          :return:  data_dict
          """
          query_string = self.environ.get('QUERY_STRING')
          query_list = parse.unquote(query_string).split('&')
          query_list = [item for item in query_list if '=' in item]
          return {item.split('=')[0]: item.split('=')[1] for item in query_list} if len(query_list) > 0 else dict()
  
      def __request_body_data(self):
          """
          è·å–è¯·æ±‚ä½“ä¸­çš„è¯·æ±‚å‚æ•°é”®å€¼å¯¹,ç›®å‰è¿™ä¸ªæ–¹æ³•åªæ”¯æŒè§£æ JSON æ ¼å¼çš„æ•°æ®
          :return:  data_dict
          """
          input_ob = self.environ.get('wsgi.input')
          data = input_ob.read()
  
          try:
              data_string = data.decode()
              data = json.loads(data_string)
          except Exception:
              data = DATA_ERROR_TIP
          finally:
              return data
  
      @property
      def url(self):
          """
          è·å–è¯·æ±‚çš„å®Œæ•´URL
          :return: URL
          """
          host = self.environ.get('HTTP_HOST')
          uri = self.environ.get('REQUEST_URI')
          return host + uri
  
      @property
      def method(self):
          """
          è·å–è¯·æ±‚æ–¹å¼
          :return: METHOD
          """
          return self.environ.get('REQUEST_METHOD')
  
      @property
      def path(self):
          """
          è·å–è¯·æ±‚è·¯å¾„
          :return: PATH
          """
          return self.environ.get('PATH_INFO')
  
      @property
      def remote_addr(self):
          """
          è·å–å®¢æˆ·ç«¯çš„IPåœ°å€
          :return: IP
          """
          return self.environ.get('REMOTE_ADDR')
  
      @property
      def req_data(self):
          """
          è·å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚å‚æ•°,æ— è®ºæ˜¯é‚£ç§æ–¹å¼éƒ½ä»è¯¥æ–¹æ³•ä¸­å–
          :return: DATA_DICT
          """
          data_dict = dict()
          if self.environ.get('CONTENT_LENGTH'):
              data_dict.update(self.__query_string_data())
              data_dict.update(self.__request_body_data())
          else:
              data_dict.update(self.__query_string_data())
          return data_dict
  
      @property
      def cookies(self):
          """
          è·å–å®¢æˆ·ç«¯å‘é€æ¥COOKIEä¿¡æ¯
          :return: COOKIE_DICT
          """
          cookie_dict = dict()
          try:
              cookie_string = self.environ.get('HTTP_COOKIE')
          except Exception:
              pass
          else:
              temp_list = cookie_string.split('; ')
              if len(temp_list) > 0:
                  temp_dict = {item.split('=')[0]: item.split('=')[1] for item in temp_list}
                  cookie_dict.update(temp_dict)
          return cookie_dict
  
      @property
      def req_headers(self):
          """
          è·å– è¯·æ±‚å¤´ ä¿¡æ¯
          :return: HEADERS_DICT
          """
          headers = dict()
          for key in self.environ.keys():
              if key.startswith('HTTP'):
                  headers[key] = self.environ.get(key)
          return headers
  
      def set_cookies(self, cookie, max_age=86400, domain=None, path='/'):
          """
          è®¾ç½®cookie
          :param cookie: cookieå­—å…¸
          :param max_age: æœ€å¤§è¿‡æœŸæ—¶é—´
          :param domain: æƒé™åŸŸå
          :param path: å­˜å‚¨è·¯å¾„
          """
          if not isinstance(cookie, dict):
              raise TypeError('The param <cookie> should be a dict type')
          if domain is None:
              domain = self.environ.get('HTTP_HOST')
          for key, value in cookie.items():
              cookie_string = '{}={}; max-age={}; domain={}; path={}'.format(key, value, max_age, domain, path)
              self.set_cookies_list.append(cookie_string)
  
  
  if __name__ == '__main__':
      pass
  
  ```

  - ###### sessionå¯¹è±¡çš„ç±»ï¼Œå†™åœ¨utils.pyæ–‡ä»¶ä¸­

  ```python
  # coding:utf-8
  """
  è¿™é‡Œæ˜¯å·¥å…·æ¨¡å—,ç”¨æ¥å­˜æ”¾åœ¨æ¡†æ¶è¿è¡Œçš„è¿‡ç¨‹ä¸­è¦ç”¨çš„ä¸€äº›åŠŸèƒ½å‡½æ•°æˆ–ç±»
  
  BaseSession ç”¨æ¥ä¿å­˜å¾€redisæ•°æ®åº“ä¸­ä¿å­˜sessionä¿¡æ¯,ç»§æ‰¿ä¸å­—å…¸,ç„¶åé‡å†™__setitem__å’Œ__getitem__æ–¹æ³•
  
  """
  from redis import StrictRedis
  from hashlib import sha3_256
  
  
  class BaseSession:
      """
      ç±»å­—å…¸ç±»
      é‡å†™å…³é”®æ–¹æ³•,å°†åŸæœ¬çš„æ“ä½œè½¬åˆ°ä½¿ç”¨redisæ•°æ®åº“å®Œæˆ
      """
  
      def __init__(self, session_config, secret_key, request_ob):
          self.redis_client = StrictRedis(host=session_config['host'], port=session_config['port'],
                                          db=session_config['database'])
          self.secret_key = secret_key
          self.request_ob = request_ob
  
      def __setitem__(self, key, value):
          """
          è®¾ç½®sessionä¿¡æ¯,å¹¶ä¿å­˜ä¸ºredisçš„å“ˆå¸Œç±»å‹.
          session_id é¦–å…ˆå°è¯•ä»è¯·æ±‚ä½“å¯¹è±¡çš„cookiesä¸­æ‰¾,å¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°çš„session_idå¹¶æ·»åŠ åˆ°è¯·æ±‚ä½“å¯¹è±¡çš„set_cookieä¸­å»
          :param key:
          :param value:
          :return:
          """
          try:
              session_id = self.request_ob.cookies.get('session_id')
              if session_id is None:
                  secret_worker = sha3_256()
                  secret_worker.update((self.secret_key + key).encode())
                  session_id = secret_worker.hexdigest()
                  self.request_ob.set_cookies({"session_id": session_id})
              session_id = 'miniFrame-session:' + session_id
              self.redis_client.hset(name=session_id, key=key, value=value)
          except Exception as e:
              raise e
  
      def __getitem__(self, key):
          try:
              session_id = self.request_ob.cookies.get('session_id')
              if session_id is None:
                  raise KeyError(
                      'The cookies dict by request not have a key named <session_id>,'
                      'you may not create a session record before this'
                  )
              session_id = 'miniFrame-session:' + session_id
              value = self.redis_client.hget(name=session_id, key=key)
              if value is None:
                  raise KeyError(
                      "The session_id or the key nonexistent in redis database"
                  )
              return value.decode()
          except Exception as e:
              raise e
  
  
  class _MiniFrameMetaClass(type):
      # ç”¨æ¥è®°å½•æˆ‘ä»¬è‡ªå®šä¹‰çˆ¶ç±»çš„æ‰€æœ‰å­ç±»åˆ—è¡¨
      record_cls = []
  
      # é‡å†™__new__æ–¹æ³•ï¼Œåœ¨åˆ›å»ºå¥½ç±»åï¼Œå¦‚æœè¿™ä¸ªç±»å¯¹è±¡ä¸æ˜¯æˆ‘ä»¬çš„çˆ¶ç±»åˆ™å°†è¿™ä¸ªå­ç±»è®°å½•ä¸‹æ¥
      def __new__(cls, name, bases, attrs):
          new_cls = type.__new__(cls, name, bases, attrs)
          if not name.startswith('Base'):
              _MiniFrameMetaClass.record_cls.append(new_cls)
          return new_cls
  
  
  if __name__ == '__main__':
      pass
  
  ```

  

- #### äº†è§£HTTPè¯·æ±‚çš„æ–¹å¼æœ‰å“ªäº›ï¼Œå¹¶æ ¹æ®è¿™äº›è¯·æ±‚æ–¹å¼è®¾è®¡è·¯ç”±æ¨¡å—å’Œç±»è§†å›¾åŸºç±»ã€‚

  æ ¹æ®HTTPæ ‡å‡†ï¼ŒHTTPè¯·æ±‚å¯ä»¥ä½¿ç”¨å¤šç§è¯·æ±‚æ–¹æ³•ã€‚

  HTTP1.0å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼š GET, POST å’Œ HEADæ–¹æ³•ã€‚

  HTTP1.1æ–°å¢äº†äº”ç§è¯·æ±‚æ–¹æ³•ï¼šOPTIONS, PUT, DELETE, TRACE å’Œ CONNECT æ–¹æ³•ã€‚

  | åºå· |  æ–¹æ³•   | æè¿°                                                         |
  | :--: | :-----: | :----------------------------------------------------------- |
  |  1   |   GET   | è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“ã€‚                         |
  |  2   |  HEAD   | ç±»ä¼¼äºgetè¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ |
  |  3   |  POST   | å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POSTè¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ/æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹ã€‚ |
  |  4   |   PUT   | ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚             |
  |  5   | DELETE  | è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚                                   |
  |  6   | CONNECT | HTTP/1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚     |
  |  7   | OPTIONS | å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚                                 |
  |  8   |  TRACE  | å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚                   |

  ##### å…è®¸å¼€å‘è€…è‡ªå·±åšå¤„ç†çš„è¯·æ±‚æ–¹å¼ä¸»è¦æ˜¯ï¼š`GET`ã€` POST`ã€`PUT`ã€`DELETE`

  ##### è®©æœåŠ¡å™¨æˆ–æ¡†æ¶è‡ªå·±å¤„ç†çš„è¯·æ±‚æ–¹å¼ä¸»è¦æ˜¯ï¼š`HEAD`ã€`OPTIONS`ã€`TRACE`

  ##### é¢„ç•™çš„è¯·æ±‚æ–¹å¼æ˜¯ï¼š`CONNECT`

  - ###### åœ¨httpæ–‡ä»¶çš„`__init__.py`ä¸­æ”¾å…¥ä¸€äº›å¸¸é‡

  ```python
  # coding:utf-8
  DEVELOPER_CONTROL_METHODS = {"GET", "POST", "PUT", "DELETE"}
  FRAME_CONTROL_METHODS = {"HEAD", "OPTIONS", "TRACE"}
  RESERVED_METHODS = {"CONNECT"}
  ```

  - ###### è®¾è®¡ç±»è§†å›¾åŸºç±»ï¼Œå†™åœ¨view.pyä¸­

  ```python
  """
  è§†å›¾æ¨¡å—,ç”¨æ¥åˆ›å»ºåŸºç¡€çš„è§†å›¾é›†ç±».
  å¼€å‘è€…é€šè¿‡ç¼–å†™ç»§æ‰¿ä¸è§†å›¾é›†åŸºç±»çš„è§†å›¾ç±»,è®©æ¡†æ¶è®°å½•è¿™äº›è§†å›¾ä»¥åŠè¿™äº›è§†å›¾å¯¹åº”çš„è·¯ç”±è§„åˆ™
  
  """
  
  
  class APIViewSet:
      """
      allow_methods   å…è®¸è¯·æ±‚çš„æ–¹å¼
  
      as_view         ç±»æ–¹æ³•,å°†è§†å›¾ç±»ä¸­çš„æ‰€æœ‰è§†å›¾æ–¹æ³•æå–å‡ºæ¥,ä»¥è¯·æ±‚æ–¹å¼ä¸ºé”®,è§†å›¾æ–¹æ³•å¼•ç”¨ä¸ºå€¼çš„æ–¹å¼æ”¾åˆ°
                      ä¸€ä¸ªå­—å…¸ä¸­å»,å¹¶è¿”å›è¿™ä¸ªå­—å…¸
      """
      allow_methods = {"GET", "POST", "PUT", "DELETE"}
  
      @classmethod
      def _get_default_all_methods(cls, exclude_methods=[]):
          """
          å°è¯•è·å–å¼€å‘è€…å®šä¹‰çš„ä¸è¯·æ±‚æ–¹å¼åŒåçš„è§†å›¾æ–¹æ³•
          :param  exclude_methods è¦æ´¾å‡ºè°ƒçš„è¯·æ±‚æ–¹å¼
          :return: views_dict è¯·æ±‚æ–¹å¼-è§†å›¾æ–¹æ³• æ˜ å°„å­—å…¸ {"è¯·æ±‚æ–¹å¼":æ–¹æ³•å¼•ç”¨}
          """
          views_dict = dict()
          req_methods = [
              req_method for req_method in cls.allow_methods if req_method not in exclude_methods
          ]
          for req_method in req_methods:
              try:
                  __function = cls().__getattribute__(req_method.lower())
              except Exception:
                  pass
              else:
                  views_dict[req_method] = __function
          return views_dict
  
      @classmethod
      def as_view(cls, view_map=None):
          """
          å°†è§†å›¾é›†ç±»ä¸­çš„ è§†å›¾æ–¹æ³•ä¸å¯¹åº”çš„è¯·æ±‚æ–¹å¼
          :param view_map:    å¼€å‘è€…è‡ªå®šä¹‰çš„è¯·æ±‚æ–¹å¼-è§†å›¾æ–¹æ³•æ˜ å°„å…³ç³» {"è¯·æ±‚æ–¹å¼":"æ–¹æ³•å"}
          :return: views_dict è¯·æ±‚æ–¹å¼-è§†å›¾æ–¹æ³• æ˜ å°„å­—å…¸ {"è¯·æ±‚æ–¹å¼":æ–¹æ³•å¼•ç”¨}
          """
          views_dict = dict()
          if view_map is None:
              views_dict.update(cls._get_default_all_methods())
  
          elif type(view_map) is not dict \
                  or set(view_map.keys()).issubset(cls.allow_methods) is False:
              raise TypeError(
                  "The param [view_map] of [as_view] must be a dict "
                  "and the keys just can chose in GET,POST,PUT,DELETE "
              )
  
          else:
              for req_method, func_name in view_map.items():
                  try:
                      __function = cls().__getattribute__(func_name)
                  except Exception as e:
                      raise e
                  else:
                      views_dict[req_method.upper()] = __function
              views_dict.update(
                  cls._get_default_all_methods(exclude_methods=view_map.keys())
              )
  
          return views_dict
  
  
  if __name__ == '__main__':
      class Test(APIViewSet):
          def get(self, request):
              print('get', request)
  
          def post(self, request):
              print('post', request),
  
          def hello(self, request):
              print("hello", request)
  
  
      views = Test.as_view({"PUT": "hello"})
      print(views)
  
  ```

- #### æ„å»ºsessionå·¥å…·ç±»å’Œç”¨æ¥åˆ›å»ºå¹¶è®°å½•ä¸­é—´ä»¶ç±»çš„å…ƒç±»_MiniFrameMetaClass

  - ###### å°†sessionå·¥å…·ç±»å’Œ_MiniFrameMetaClasså…ƒç±»ï¼Œå†™åœ¨utils.pyæ–‡ä»¶ä¸­

  ```python
  """
  è·¯ç”±æ¨¡å—,è®©å¼€å‘è€…é€šè¿‡ç‰¹å®šçš„æ–¹æ³•èƒ½å°†è·¯ç”±è§„åˆ™å’Œè§†å›¾è”ç³»èµ·æ¥.
  å½“ç”¨æˆ·åˆ›å»ºå¥½è¿™äº›æ˜ å°„å…³ç³»å,è¿™äº›è·¯ç”±æ˜ å°„å…³ç³»éƒ½å°†è¢«æ¡†æ¶è®°å½•èµ·æ¥.
  åŒæ ·ä½¿ç”¨çˆ¶ç±»è‡ªåŠ¨æ³¨å†Œå­ç±»çš„æ–¹æ³•,å®ç°è®°å½•è¿™äº›è·¯ç”±è§„åˆ™å¯¹è±¡
  """
  import re
  import inspect
  from miniFrame.http import DEVELOPER_CONTROL_METHODS, FRAME_CONTROL_METHODS, RESERVED_METHODS
  
  
  class BaseRouter:
      """
      è·¯ç”±å¯¹è±¡ç±»
      developer_control_methods   å¼€å‘è€…æ§åˆ¶çš„è¯·æ±‚æ–¹å¼
      frame_control_methods       æ¡†æ¶æ§åˆ¶çš„è¯·æ±‚æ–¹å¼
      reserved_methods            HTTPåè®®é¢„ç•™çš„è¯·æ±‚æ–¹å¼
      """
      developer_control_methods = DEVELOPER_CONTROL_METHODS
      frame_control_methods = FRAME_CONTROL_METHODS
      reserved_methods = RESERVED_METHODS
  
      def __init__(self, re_url_path, views=None):
          """
          :param re_url_path        å®šä¹‰çš„è·¯ç”±è·¯å¾„æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²
          :param views              ç»‘å®šçš„è§†å›¾å­—å…¸ {"è¯·æ±‚æ–¹å¼":"å¯¹åº”çš„è§†å›¾å‡½æ•°æˆ–æ–¹æ³•"}
          _param_compile      åŒ¹é… _re_url_path ä¸­çš„å‚æ•°åçš„æ­£åˆ™è¡¨è¾¾å¼
          path_param_values   ä»è·¯ç”±ä¸­è·å–åˆ°çš„å‚æ•°å€¼å­—å…¸ {"æ­£åˆ™ç»„å":"æå–åˆ°çš„å€¼"}
          """
          self.__re_url_path = re_url_path
          self.__views = views
          self.__param_compile = re.compile(r'<(.+?)>')
          self.path_param_values = None
  
      def re_check_path(self, path):
          """
          è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²çš„è·¯ç”±åŒ¹é…,æ£€æµ‹è¯·æ±‚è·¯å¾„æ˜¯å¦å­˜åœ¨,
          å°è¯•ä»è·¯å¾„è·å–å»å‚æ•°å€¼,å¹¶èµ‹å€¼ç»™å¯¹è±¡çš„path_param_valueså±æ€§.
  
          :param path: è¯·æ±‚ä¿¡æ¯ä¸­çš„URLè·¯å¾„
  
          :return:  self --> è·¯ç”±åŒ¹é…æˆåŠŸ,å¹¶è¿”å›è·¯ç”±å¯¹è±¡è‡ªå·±
                    404  --> è·¯ç”±åŒ¹é…å¤±è´¥ not found
          """
          re_param_names = self.__param_compile.findall(self.__re_url_path)
          path_re_compile = re.compile(self.__re_url_path)
          path_re_result = path_re_compile.match(path)
          if path_re_result is not None:
              self.path_param_values = {name: path_re_result.group(name) for name in re_param_names}
              return self
          else:
              return 404
  
      def check_method(self, method):
          """
          æ£€æŸ¥è¯·æ±‚æ–¹å¼æ˜¯å¦ç¬¦åˆè§„å®š,å¹¶é’ˆå¯¹ä¸åŒçš„è¯·æ±‚æ–¹å¼ä½œå‡ºå“åº”çš„å¤„ç†
  
          :param method:  ä»æœåŠ¡å™¨è·å–åˆ°çš„æµè§ˆå™¨çš„è¯·æ±‚æ–¹å¼
  
          :return: view  --> æˆåŠŸåŒ¹é…åå¯¹åº”çš„è§†å›¾å‡½æ•°æˆ–æ–¹æ³•
                   method --> å¦‚æœè¯·æ±‚æ–¹å¼ä¸åœ¨å¼€å‘è€…æ§åˆ¶çš„èŒƒå›´å†…,ç›´æ¥è¿”å›è¯·æ±‚æ–¹å¼,è®©å…¶ä»–åŠŸèƒ½æ¨¡å—å»å¤„ç†
                   405   --> è¯·æ±‚æ–¹å¼åŒ¹é…å¤±è´¥, method not allowed
  
          """
          if method in self.__views.keys():
              return self.__views[method]
          if method in self.frame_control_methods or method in self.reserved_methods:
              return method
          return 405
  
  
  def re_path(re_url_path, view):
      """
      æ ¹æ®ä¼ å…¥çš„ è·¯ç”± å’Œ è§†å›¾ æ„å»ºä¸€ä¸ªè·¯ç”±å¯¹è±¡.
      è§†å›¾å¯¹è±¡å¯ä»¥æ˜¯ä¸ªå‡½æ•°æˆ–è€…å­—å…¸,å¦‚æœæ˜¯å‡½æ•°åˆ™ä¼šæ£€æµ‹ å½¢å‚æ˜¯å¦ç¬¦åˆè¯­æ³•è®¾è®¡;å¦‚æœæ˜¯å­—å…¸åˆ™ä¼šæ£€æµ‹ é”®æ˜¯å¦è¢«å…è®¸
      :param re_url_path:     è·¯ç”±è§„åˆ™çš„æ­£åˆ™è¡¨è¾¾å¼
      :param view:            è§†å›¾å‡½æ•° æˆ–è€… è¯·æ±‚æ–¹å¼-å‡½æ•° å­—å…¸{'GET':view1, 'POST':view2}
      :return router          è·¯ç”±å¯¹è±¡
      """
      if len(re_url_path) == 0 or type(re_url_path) is not str:
          raise TypeError(
              'url path rule string for the view is must be type of str, and length over than zero'
          )
  
      if inspect.isfunction(view):
          try:
              func_FullArgSpec = inspect.getfullargspec(view)
              func_params = func_FullArgSpec.args
              func_params_default_values = func_FullArgSpec.defaults
              if func_params != ['request', 'method']:
                  raise SyntaxError(
                      'View functions [{}] just need two params : <request> and <method>'.format(
                          view.__name__)
                  )
  
              if len(func_params_default_values) != 1 \
                      or len(func_params_default_values[0]) == 0 \
                      or type(func_params_default_values[0]) != list \
                      or set(func_params_default_values[0]).issubset(DEVELOPER_CONTROL_METHODS) is not True:
                  raise SyntaxError(
                      '\tView functions [{}] just allow and also require param <method> have a default value,'
                      '\nand the value must be a sublist of ["GET", "POST", "PUT", "DELETE"],'
                      '\nand the value not allowed be a empty list.'.format(view.__name__)
                  )
          except Exception as e:
              raise e
          else:
              views = {method.upper(): view for method in func_params_default_values[0]}
              return BaseRouter(re_url_path=re_url_path, views=views)
  
      elif type(view) is dict:
          if set(view.keys()).issubset({"GET", "POST", "PUT", "DELETE"}):
              return BaseRouter(re_url_path=re_url_path, views=view)
          else:
              raise TypeError('Here a method in your ViewSet not allowed')
      else:
          raise TypeError(
              'The second param of [ re_path() ] must be a functions or a result of your ViewSetClass.as_view()'
          )
  
  
  if __name__ == '__main__':
      pass
  
  ```

- #### æ„å»ºä¸­é—´ä»¶çš„åŸºç±»ï¼Œè®¾è®¡ä¸­é—´ä»¶æ–¹æ³•

  - ###### å°†ä¸­é—´ä»¶çš„åŸºç±»ï¼Œå†™åœ¨middleware.pyä¸­

  ```python
  # coding:utf-8
  """
  ç”¨æ¥å­˜æ”¾ä¸­é—´ä»¶çš„æ¨¡å—,ä¸­é—´å»ºå°†ç”¨ä¸»è¦æœ‰ä¸¤ä¸ª,ä¸€ä¸ªæ˜¯æ˜¯åœ¨æ„å»ºè¯·æ±‚ä½“ä¹‹å‰æ‰§è¡Œ,å¦ä¸€ä¸ªæ˜¯åœ¨æ„å»ºå“åº”ä½“ä¹‹åæ‰§è¡Œ
  æœ¬æ¡†æ¶çš„ä¸­é—´ä»¶å°†ä»¥ç±»çš„å½¢å¼,é€šè¿‡è‡ªå®šä¹‰ç±»åˆ›å»ºæ—¶æŒ‡å®šçš„å…ƒç±»,å®ç°çˆ¶ç±»è‡ªåŠ¨æ³¨å†Œç»§æ‰¿ä¸ä»–çš„å­ç±»
  
  """
  from miniFrame.utils import _MiniFrameMetaClass
  
  
  class BaseMiddleWare(object, metaclass=_MiniFrameMetaClass):
  
      def before_request(self, env):
          """
          åœ¨æ„å»ºè¯·æ±‚ä½“å¯¹è±¡ä¹‹å‰æ‰§è¡Œ,è¿”å›çš„æ•°æ®å¯ä»¥æ˜¯ envå­—å…¸ æˆ–è€… response å¯¹è±¡
          å¦‚æœè¿”å›çš„æ˜¯ response å¯¹è±¡,åˆ™ä¼šæå‰å®Œæˆæœ¬æ¬¡è¯·æ±‚.è¿”å›çš„æ˜¯ envå­—å…¸ çš„è¯åˆ™ç»§ç»­å®Œæˆè¯·æ±‚
          :param env: è¯·æ±‚ä¿¡æ¯å­—å…¸
          :return: env or response_ob
          """
          pass
          return env
  
      def after_request(self, request):
          """
          åœ¨æ„å»ºå¥½è¯·æ±‚ä½“å¯¹è±¡ä¹‹åæ‰§è¡Œ,è¿”å›çš„æ•°æ®å¯ä»¥æ˜¯ requestå¯¹è±¡ æˆ–è€… response å¯¹è±¡
          å¦‚æœè¿”å›çš„æ˜¯ response å¯¹è±¡,åˆ™ä¼šæå‰å®Œæˆæœ¬æ¬¡è¯·æ±‚.è¿”å›çš„æ˜¯ requestå¯¹è±¡ çš„è¯åˆ™ç»§ç»­å®Œæˆè¯·æ±‚
          :param request: è¯·æ±‚ä½“å¯¹è±¡
          :return: request_ob or response_ob
          """
          pass
          return request
  
      def after_response(self, response):
          """
          åœ¨æ„å»ºå¥½å“åº”ä½“å¯¹è±¡ä¹‹åæ‰§è¡Œ,è¿”å›çš„æ•°æ®å¿…é¡»æ˜¯å“åº”ä½“å¯¹è±¡
          :param response:
          :return: response_ob
          """
          pass
          return response
  
  
  if __name__ == '__main__':
      pass
  
  ```

- #### äº†è§£éœ€è¦æ¡†æ¶å’Œå¼€å‘è€…è®¾ç½®çš„å“åº”å¤´çš„å†…å®¹æœ‰å“ªäº›ï¼Œå¹¶æ ¹æ®è¿™äº›ç±»å®¹è®¾è®¡æˆ‘çš„å“åº”å¤„ç†çš„ç›¸å…³æ¨¡å—

  - ##### å¯¹æ¯”æµè§ˆå™¨æ‹¿åˆ°çš„å“åº”ä¿¡æ¯å’Œæˆ‘ä»¬åœ¨testuwsgi.pyä¸­è‡ªå·±æ·»åŠ çš„å“åº”ä¿¡æ¯

    æˆ‘ä»¬è‡ªå·±è®¾å®šçš„å“åº”ä¿¡æ¯ä¸»è¦æ˜¯ï¼š

    - å“åº”è¡Œä¿¡æ¯ï¼š200 OK
    - å“åº”æ•°æ®ç±»å‹ï¼š('Content-Type', 'text/html')
    - å…è®¸è·¨åŸŸè¯·æ±‚ç›¸å…³çš„å“åº”å¤´ï¼Œè®¾ç½®Cookieä¿¡æ¯çš„å“åº”å¤´

    æµè§ˆå™¨æ‹¿åˆ°çš„å“åº”å¤´ä¿¡æ¯ï¼š

    ###### éè·¨åŸŸ

    ![image-20180802152026814](./media/work-miniFrame-images/image-20180802152026814.png)

    ###### è·¨åŸŸ

    ![image-20180802152336598](./media/work-miniFrame-images/image-20180802152336598.png)

    ##### å¯ä»¥çœ‹å‡ºéƒ¨åˆ†åŸºç¡€ä¿¡æ¯ç”±uWSGIå’ŒNginxæœåŠ¡å™¨å¸®æˆ‘ä»¬è‡ªåŠ¨è¡¥å……å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒå’Œå“åº”çŠ¶æ€å’Œå…¶ä»–ç‰¹æ®ŠåŠŸèƒ½çš„å“åº”ä¿¡æ¯å³å¯

    ###### å¸¸ç”¨çš„å“åº”è¡Œä¿¡æ¯

    ```python
    status_info_map = {
        200: " OK",
        201: " Created",
        202: " Accepted",
        301: " Moved Permanently",
        302: " Found",
        400: " Bad Request",
        401: " Unauthorized",
        403: " Forbidden",
        404: " Not Found",
        405: " Method Not Allowed",
        500: " Internal Server Error",
        503: " Service Unavailable",
    }
    ```

  - ###### è®¾è®¡å“åº”ä½“åŸºç±»ï¼Œå’Œåœ¨å‰åç«¯åˆ†ç¦»ä¸­å¸¸ç”¨çš„JSONæ•°æ®æ ¼å¼çš„å“åº”ä½“ç±»ã€‚å†™åœ¨response.pyä¸­

  ```python
  # coding:utf-8
  """
  æ‰€æœ‰å’Œå¤„ç†å“åº”ä¿¡æ¯æœ‰å…³çš„åŠŸèƒ½çš„ä»£ç éƒ½å°†æ”¾åœ¨è¿™é‡Œ
  BaseResponse    å“åº”ä½“åŸºç±»
  
  """
  import json
  
  STATUS_CODE_SUPPORT = {
      200: " OK",
      201: " Created",
      202: " Accepted",
      301: " Moved Permanently",
      302: " Found",
      400: " Bad Request",
      401: " Unauthorized",
      403: " Forbidden",
      404: " Not Found",
      405: " Method Not Allowed",
      500: " Internal Server Error",
      503: " Service Unavailable",
  }
  
  
  class BaseResponse:
      def __init__(self, data, status_code, content_type, extra_headers={}):
          """
          åˆå§‹åŒ–è§†å›¾å¯¹è±¡
          :param data: å“åº”çš„æ•°æ® <str>
          :param status_code: å“åº”çŠ¶æ€ç  <int>
          :param content_type: å“åº”å†…å®¹çš„ç±»å‹ <str>
          :param extra_headers: é¢å¤–çš„å“åº”å¤´ä¿¡æ¯ <dict>
  
          request_ob æœ¬æ¬¡è¯·æ±‚è¿‡ç¨‹ä¸­çš„è¯·æ±‚ä½“å¯¹è±¡
          """
  
          self.data = data
          self.status_code = status_code
          self.content_type = content_type
          self.extra_headers = extra_headers
          self.request_ob = None
  
      def __check_params(self):
          """
          æ£€æŸ¥responseå¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„æ•°æ®ç±»å‹æ˜¯å¦ç¬¦åˆè¦æ±‚
          """
          if not isinstance(self.data, str):
              raise TypeError('The data for [BaseResponse] must be a type of str')
          if not isinstance(self.status_code, int):
              raise TypeError('The status code for [BaseResponse] must be a type of int]')
          if not isinstance(self.content_type, str):
              raise TypeError('The content type for [BaseResponse] must be a type of str')
          if not isinstance(self.extra_headers, dict):
              raise TypeError('The extra_headers for [BaseResponse] must be a type of dict')
          if not self.request_ob:
              raise TypeError('The request object is None when in [BaseResponse]')
  
      def __create_response_line(self):
          """
          åˆ›å»ºä¸status_codeå¯¹åº”çš„å“åº”è¡Œå­—ç¬¦ä¸²
          :return response_line å“åº”è¡Œä¿¡æ¯å­—ç¬¦ä¸²
          """
          if self.status_code not in STATUS_CODE_SUPPORT.keys():
              raise Exception(
                  'The status code is not supported by frame at present!you can chose change source code of this frame.'
              )
          response_line = str(self.status_code) + STATUS_CODE_SUPPORT[self.status_code]
          return response_line
  
      def __create_response_headers(self):
          """
          åˆ›å»ºç›¸åº”çš„å“åº”å¤´ä¿¡æ¯çš„åˆ—è¡¨,æ•°æ®æ ¼å¼:[("key", "value"), ("key", "value")]
          :return response_headers å“åº”å¤´ä¿¡æ¯åˆ—è¡¨
          """
          if len(self.content_type) == 0:
              raise Exception("The Content-Type not allow be a empty string")
          response_headers = [("Content-Type", self.content_type)]
          for key, value in self.extra_headers.items():
              response_headers.append((key, value))
          for item in self.request_ob.set_cookies_list:
              response_headers.append(('Set-Cookie', item))
          return response_headers
  
      @property
      def response_data(self):
          """
          è¿”å›å®Œæˆå“åº”éœ€è¦çš„å„ç§ä¿¡æ¯
          :return: response_info_dict   {'line':"å“åº”è¡Œ", 'headers':"å“åº”å¤´", 'body':"å“åº”ä½“"}
          """
          self.__check_params()
          response_info_dict = dict(
              line=self.__create_response_line(),
              headers=self.__create_response_headers(),
              body=self.data.encode()
          )
          return response_info_dict
  
  
  class JsonResponse(BaseResponse):
      def __init__(self, data, status_code=200, extra_headers={}):
          if not isinstance(data, dict):
              raise Exception("JsonResponse only support data type of dict")
          content_type = "application/json;charset=utf-8"
          data = json.dumps(data)
          super().__init__(
              data=data,
              status_code=status_code,
              content_type=content_type,
              extra_headers=extra_headers
          )
  
  
  class HTTPResponse(BaseResponse):
      def __init__(self, data, status_code=200, extra_headers={}):
          if not isinstance(data, str):
              raise Exception("HTTPResponse only support data type of str")
          content_type = "text/html;charset=utf-8"
          super().__init__(
              data=data,
              status_code=status_code,
              content_type=content_type,
              extra_headers=extra_headers
          )
  
  
  class Redirect(BaseResponse):
      def __init__(self, url, status_code=302, extra_headers={}):
          if not isinstance(url, str):
              raise Exception("The url to redirect must be a string")
          if status_code in [301, 302]:
              extra_headers['Location'] = url
              super().__init__(
                  data="",
                  status_code=status_code,
                  content_type='text/html',
                  extra_headers=extra_headers
              )
          else:
              raise Exception("The status code for redirect must be 3XX")
  
  
  if __name__ == '__main__':
      pass
  
  ```

- #### è®¾è®¡å¹¶æ„å»ºæ ¸å¿ƒçš„Applicationç±»

  - ###### å°†æ¡†æ¶å¯¹è¯·æ±‚ä¿¡æ¯åšå¤„ç†çš„æ ¸å¿ƒæµç¨‹ç±»ï¼Œå†™åœ¨core.pyæ–‡ä»¶ä¸­

  ```python
  # coding:utf-8
  """
  æ¡†æ¶çš„æ ¸å¿ƒï¼Œæ¥å—ä»æœåŠ¡å™¨è½¬å‘è¿›æ¥çš„æ•°æ®ï¼Œ
  åˆ¤æ–­è¯·æ±‚æ˜¯å¦å…è®¸
  æ„å»ºè¯·æ±‚å¯¹è±¡
  è°ƒç”¨ç›¸åº”çš„è§†å›¾ï¼Œè·å–å“åº”
  æ„å»ºå“åº”å¯¹è±¡ï¼Œå¹¶å°†æ•°æ®è¿”å›ç»™æœåŠ¡å™¨
  """
  import importlib
  from miniFrame.utils import _MiniFrameMetaClass
  from miniFrame.http.response import BaseResponse, HTTPResponse
  from miniFrame.http.request import BaseRequest
  from miniFrame.utils import BaseSession
  from miniFrame.http.url import BaseRouter
  from miniFrame.http import FRAME_CONTROL_METHODS
  
  
  class MiniFrame:
  
      def __init__(self, config_import_path=None):
          """
          åˆå§‹åŒ–MiniFrameå¯¹è±¡,å¹¶å¯ä»¥é€‰åˆ™åœ¨æ­¤æ—¶é€šè¿‡configæ¨¡å—çš„å¯¼åŒ…è·¯å¾„ åŠ è½½é…ç½®é¡¹
          """
          if config_import_path is None:
              return
          try:
              self.__add_config_from_import_path(config_import_path)
          except Exception as e:
              raise e
  
      def __call__(self, env, set_resp_headers):
          """
          å½“å¯¹è±¡è¢«è°ƒç”¨æ—¶æ‰§è¡Œè¯¥æ–¹æ³•
          :return: å“åº”ä¿¡æ¯
          """
          # æ„å»ºè¯·æ±‚ä½“å¯¹è±¡
          request_ob = BaseRequest(env)
          request_ob.session = BaseSession(
              session_config=self.database_conf['Redis'],
              secret_key=self.SECRET_KEY,
              request_ob=request_ob
          )
  
          # è·å–åˆ°æ‰€æœ‰çš„ä¸­é—´ä»¶å¯¹è±¡,å¹¶ä¿å­˜åˆ°åˆ—è¡¨ä¸­
          middleware_ob_list = self.__get_middleware_obs()
  
          # æ‰§è¡Œæ‰€æœ‰ä¸­é—´ä»¶å¯¹è±¡ä¸­ "before_request" æ–¹æ³•,å¹¶åˆ¤æ–­è¿”å›å€¼
          env = self.__before_request(
              env=env,
              middleware_obs=middleware_ob_list
          )
          if isinstance(env, BaseResponse):
              env.request_ob = request_ob
              info_dict = env.response_data
              set_resp_headers(info_dict["line"], info_dict["headers"])
              return info_dict["body"]
  
          # æ‰§è¡Œæ‰€æœ‰ä¸­é—´å¯¹è±¡ä¸­çš„ "after_request" æ–¹æ³•,å¹¶åˆ¤æ–­è¿”å›å€¼
          request = self.__after_request(
              request_ob=request_ob,
              middleware_obs=middleware_ob_list
          )
          if isinstance(request, BaseResponse):
              request.request_ob = request_ob
              info_dict = request.response_data
              set_resp_headers(info_dict["line"], info_dict["headers"])
              return info_dict["body"]
  
          # æ‰§è¡Œ "__get_router_ob "æ£€æŸ¥è·¯å¾„,å°è¯•è·å– router å¯¹è±¡
          router_ob = self.__get_router_ob(path_info=request_ob.path)
          if router_ob is None:
              response = HTTPResponse(data="Not Found", status_code=404)
              response.request_ob = request_ob
              info_dict = response.response_data
              set_resp_headers(info_dict["line"], info_dict["headers"])
              return info_dict["body"]
  
          # æ‰§è¡Œ router_ob å¯¹è±¡çš„ "_check_method" æ–¹æ³•,æ£€æŸ¥è¯·æ±‚æ–¹å¼,å°è¯•è·å– è§†å›¾å‡½æ•°æˆ–æ–¹æ³•
          view_method = router_ob.check_method(method=request_ob.method)
          print("--[view method]--", view_method, ":>:", env.get('REQUEST_URI'))
          if view_method == 405:
              response = HTTPResponse(data="Method not allowed", status_code=405)
              info_dict = response.response_data
              set_resp_headers(info_dict["line"], info_dict["headers"])
              return info_dict["body"]
  
          if view_method in FRAME_CONTROL_METHODS:
              tip = "å¤„ç†è·¨åŸŸæˆ–è€…å…¶ä»–ç”±æ¡†æ¶å¤„ç†çš„è¯·æ±‚æ–¹å¼çš„ä»£ç å°±äº¤ç»™åŒå­¦ä»¬è‡ªå·±ç ”ç©¶å•¦"
              set_resp_headers('200 OK', [("Content-Type", "text/html;charset=utf-8")])
              return tip.encode()
  
          # å°† router_obå¯¹è±¡ æºå¸¦çš„ä»è·¯å¾„ä¸­æå–çš„å‚æ•°æ·»åŠ ç»™ requestå¯¹è±¡
          request_ob.path_data = router_ob.path_param_values
  
          # æ‰§è¡Œè§†å›¾å‡½æ•°æˆ–æ–¹æ³•,è·å–å“åº”å¯¹è±¡,å¹¶åˆ¤æ–­å¯¹è±¡æ˜¯å¦åˆæ³•
          response_ob = view_method(request_ob)
          if not isinstance(response_ob, BaseResponse):
              raise TypeError("The view function or method need return a Response object!")
  
          # ä¸º response_ob å¯¹è±¡çš„å±æ€§ request_ob æ·»åŠ å€¼
          response_ob.request_ob = request_ob
  
          # æ‰§è¡Œæ‰€æœ‰ä¸­é—´ä»¶å¯¹è±¡ä¸­ "after_response" æ–¹æ³•,å¹¶åˆ¤æ–­è¿”å›å€¼
          response_ob = self.__after_response(
              response_ob=response_ob,
              middleware_obs=middleware_ob_list
          )
          if not isinstance(response_ob, BaseResponse):
              raise TypeError(
                  "The method [after_response ] of middleware class need return a Response object!"
              )
  
          # ä¸€åˆ‡éƒ½æ²¡æœ‰é—®é¢˜,è®¾ç½®å“åº”å¤´ä¿¡æ¯,å¹¶è¿”å›å“åº”ä½“æ•°æ®
          info_dict = response_ob.response_data
          set_resp_headers(info_dict["line"], info_dict["headers"])
          return info_dict["body"]
  
      def __get_middleware_obs(self):
          """
          è·å–æ‰€æœ‰å¹´çš„ä¸­é—´ä»¶ç±»,å¹¶åˆ›å»ºå¯¹è±¡æ·»åŠ åˆ°åˆ—è¡¨ä¸­å»
          :return: ä¸­é—´ä»¶å¯¹è±¡åˆ—è¡¨
          """
          cls_list = _MiniFrameMetaClass.record_cls
          return [cls() for cls in cls_list]
  
      def __before_request(self, env, middleware_obs):
          """
          æ‰§è¡Œæ‰€æœ‰ä¸­é—´å¯¹è±¡çš„ before_request æ–¹æ³•
          :param env: è¯·æ±‚ä¿¡æ¯å­—å…¸
          :param middleware_obs: ä¸­é—´ä»¶å¯¹è±¡åˆ—è¡¨
          :return: env or response_ob
          """
          for mid_ob in middleware_obs:
              env = mid_ob.before_request(env)
              if isinstance(env, BaseResponse):
                  return env
          return env
  
      def __after_request(self, request_ob, middleware_obs):
          """
          æ‰§è¡Œæ‰€æœ‰ä¸­é—´å¯¹è±¡çš„ after_request æ–¹æ³•
          :param request_ob: è¯·æ±‚ä½“å¯¹è±¡
          :param middleware_obs: ä¸­é—´ä»¶å¯¹è±¡åˆ—è¡¨
          :return: request_ob or response_ob
          """
          for mid_ob in middleware_obs:
              request_ob = mid_ob.after_request(request_ob)
              if isinstance(request_ob, BaseResponse):
                  return request_ob
          return request_ob
  
      def __get_router_ob(self, path_info):
          """
          éå†æ‰€æœ‰æ³¨å†Œäº†çš„è·¯ç”±å¯¹è±¡å»æ ¡éªŒè·¯ç”±,ç›´åˆ°è·¯ç”±åŒ¹é…æˆåŠŸ,æˆ–åœ¨å…¨éƒ¨å¤±è´¥
          :param path_info: è¯·æ±‚è·¯å¾„
          :return: router_ob or None
          """
          for router_ob in self.routers:
              ret = router_ob.re_check_path(path=path_info)
              if isinstance(ret, BaseRouter):
                  return ret
  
      def __after_response(self, response_ob, middleware_obs):
          """
          æ‰§è¡Œæ‰€æœ‰ä¸­é—´å¯¹è±¡çš„ after_response æ–¹æ³•
          :param response_ob: å“åº”ä½“å¯¹è±¡
          :param middleware_obs: ä¸­é—´ä»¶å¯¹è±¡åˆ—è¡¨
          :return: response_ob
          """
          for mid_ob in middleware_obs:
              response_ob = mid_ob.after_response(response_ob)
          return response_ob
  
      def __add_config_from_import_path(self, config_import_path):
          # å¯¼å…¥configæ¨¡å—,å¹¶å°†æ¨¡å—å¯¹è±¡ç”¨, å¹¶å°†å…¶æ·»åŠ ç»™ç±»å±æ€§
          config_module_ob = importlib.import_module(config_import_path)
  
          # é€šè¿‡configæ¨¡å—å¯¹è±¡è·å–æ‰€æœ‰å…è®¸è®¿é—®çš„ORIGINåˆ—è¡¨
          self.allow_origins = config_module_ob.ALLOW_ORIGIN
  
          # é€šè¿‡configæ¨¡å—å¯¹è±¡è·å–æ‰€æœ‰çš„è·¯ç”±å¯¹è±¡
          routers_path_list = config_module_ob.ROUTERS_PATH
          self.routers = list()
          for router_import_path in routers_path_list:
              router_module_ob = importlib.import_module(router_import_path)
              routers_list = router_module_ob.path_map
              self.routers.extend(routers_list)
  
          # é€šè¿‡configæ¨¡å—å¯¹è±¡è·å–æ‰€æœ‰çš„ä¸­é—´ä»¶æ¨¡å—çš„å¯¼åŒ…è·¯å¾„,å¹¶å¯¼å…¥è¿™äº›æ¨¡å—.
          # é‚£ä¹ˆè¿™äº›ä¸­é—´ä»¶æ¨¡å—çš„ä¸­çš„åˆ›å»ºä¸­é—´å­ç±»ä»£ç æ‰§è¡Œå,ä¼šè¢«æˆ‘ä»¬è‡ªå®šä¹‰çš„å…ƒç±»æ³¨å†Œ.
          middleware_import_paths = config_module_ob.MIDDLEWARE_PATH
          for middleware_import_path in middleware_import_paths:
              importlib.import_module(middleware_import_path)
  
          # é€šè¿‡configæ¨¡å—å¯¹è±¡è·å–æ‰€æœ‰å…³äºæ•°æ®åº“çš„é…ç½®,å¹¶ä¿å­˜ä¸ºå®ä¾‹å±æ€§
          self.database_conf = config_module_ob.DATABASE_CONFIG
  
          # é€šè¿‡configæ¨¡å—å¯¹è±¡è·å–è®¾ç½®çš„å¯†é’¥æ··æ·†å­—ç¬¦ä¸²
          self.SECRET_KEY = config_module_ob.SECRET_KEY
  
      def init_app(self, config_import_path):
          try:
              self.__add_config_from_import_path(config_import_path)
          except Exception as e:
              raise e
  
  
  if __name__ == '__main__':
      pass
  
  ```

------



## äº”ã€è®¾è®¡æˆ‘ä»¬æƒ³è¦çš„é¡¹ç›®åˆå§‹ç»“æ„ï¼Œå’Œæ–‡ä»¶å†…å®¹

- ##### é¢„æƒ³ä¸­çš„é¡¹ç›®æ–‡ä»¶ã€æ¨¡å—ã€‘ç»“æ„

###### ![image-20180808204854078](./media/work-miniFrame-images/image-20180808204854078.png)

- ##### å„ä¸ªæ–‡ä»¶ã€æ¨¡å—ã€‘ä¸­çš„å†…å®¹

  - `ApiStore/config.py`			é¡¹ç›®ç›¸å…³çš„é…ç½®
  	 `ApiStore/middelware.py`		å¼€å‘è€…å®šä¹‰çš„ä¸­é—´ä»¶
  	 `ApiStore/models.py`			æ¨¡å‹ç±»
  	 `ApiStore/routers.py`		é…ç½®è§†å›¾è·¯ç”±ï¼Œåˆ›å»ºè·¯ç”±å¯¹è±¡
  	 `ApiViews/exampleViews.py`	è§†å›¾
  	 `manager.py`					é¡¹ç›®å¯åŠ¨ä¸»æ–‡ä»¶	
  	 `uwsgi.ini`				        é¡¹ç›®å¯åŠ¨uWSGIæœåŠ¡é…ç½®æ–‡ä»¶

- ##### å„æ–‡ä»¶ã€æ¨¡å—ã€‘å…·ä½“ä»£ç 

  ApiStore/config.py

  ```python
  # coding:utf-8
  # these are the configs for this Project
  
  """
  é…ç½®æ–‡ä»¶,é…ç½®é¡¹å˜é‡åçš„å¯¹åº”çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯åˆ—è¡¨æˆ–å­—å…¸,å¦åˆ™å¯èƒ½é€ æˆæ­¤é…ç½®é¡¹æ— æ³•è¢«åŠ è½½.
  å·²ç»é¢„è®¾å¥½çš„é…ç½®é¡¹çš„å˜é‡åä¸å…è®¸ä¿®æ”¹.
  å…è®¸æ·»åŠ ç¬¦åˆè§„åˆ™çš„è‡ªå®šä¹‰é…ç½®é¡¹,å¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡å…¨å±€çš„ MiniFrame.
  """
  # åŠ å¯†æ··æ·†å­—ç¬¦ä¸²
  SECRET_KEY = "Please set your secret key here"
  
  # è·¯ç”±å¯¼åŒ…è·¯å¾„
  ROUTERS_PATH = [
      'ApiStore.routers'
  ]
  
  # å…è®¸è®¿é—®çš„åŸŸå
  ALLOW_ORIGIN = [
      '127.0.0.1:8000'
  ]
  
  # ä¸­é—´ä»¶çš„å¯¼åŒ…è·¯å¾„
  MIDDLEWARE_PATH = [
      'ApiStore.middleware'
  ]
  
  # æ•°æ®åº“çš„ç›¸å…³é…ç½®
  DATABASE_CONFIG = {
      "MySQL": {
          "host": "127.0.0.1",
          "port": 3306,
          "database": "miniframe",
          "user": "root",
          "password": "mysql"
      },
      "Redis": {
          "host": '127.0.0.1',
          "port": 6379,
          "database": 0
  
      }
  }
  
  ```

  ApiStore/routers.py

  ```python
  # coding:utf-8
  from miniFrame.http.url import re_path
  from ApiViews import exampleViews
  
  path_map = [
      re_path(r'^/$', exampleViews.ExcampleViewSet.as_view()),
      re_path(r'^/index/(?P<testParam>.+)/$', exampleViews.excampleViewFunc),
  
  ]
  
  ```

  ApiViews/exampleViews.py

  ```python
  # coding:utf-8
  from miniFrame.view import APIViewSet
  from miniFrame.http.response import HTTPResponse, JsonResponse
  
  
  class ExcampleViewSet(APIViewSet):
  
      def get(self, request):
          print("#" * 20, "ExcampleViewSet.get")
          print("path prams data:", request.path_data)
          print("query string and request body data:", request.req_data)
          return HTTPResponse(data="Hello GET")
  
      def post(self, request):
          print("#" * 20, "ExcampleViewSet.post")
          print("path prams data:", request.path_data)
          print("query string and request body data:", request.req_data)
          return HTTPResponse(data="Hello POST")
  
  
  def excampleViewFunc(request, method=['GET']):
      print("#" * 20, "excampleViewFunc")
      print("path prams data:", request.path_data)
      print("query string and request body data:", request.req_data)
      return JsonResponse(data={"hello": "excampleViewFunc"})
  
  ```

  manager.py

  ```python
  # coding:utf-8
  import os
  import sys
  from miniFrame.core import MiniFrame
  
  BaseDir = os.path.dirname(os.path.abspath(__file__))
  sys.path.insert(0, BaseDir)
  CONFIG_IMPORT_PATH = 'ApiStore.config'
  
  
  def application(env, start_response):
      try:
          mini_app = MiniFrame()
          mini_app.init_app(config_import_path=CONFIG_IMPORT_PATH)
      except Exception as e:
          raise e
      else:
          return mini_app(env=env, set_resp_headers=start_response)
  
  
  if __name__ == '__main__':
      pass
  
  ```

  uwsgi.ini

  ```ini
  [uwsgi]
  ;socket = 127.0.0.1:8000
  http = 127.0.0.1:8000
  chdir = /home/itcast/Desktop/installFrame/excample
  wsgi-file = /home/itcast/Desktop/installFrame/excample/manager.py
  
  ```

------



## å…­ã€å®‰è£…miniFrameæ¡†æ¶åˆ°site-packagesä¸­ï¼Œå¹¶å®Œå–„å¥½æ¡†æ¶éœ€è¦æä¾›çš„shellå‘½ä»¤

- ##### äº†è§£å°†è‡ªå·±å¼€å‘çš„æ¨¡å—å®‰è£…åˆ°ç¯å¢ƒä¸­éœ€è¦åˆ›å»ºè‡³å°‘å“ªäº›æ–‡ä»¶

  - ##### ç®€æ˜“æ•™ç¨‹é“¾æ¥ï¼šhttps://ecmadao.gitbooks.io/python3/content/setuppy.html ã€éœ€è¦ç§‘å­¦ä¸Šç½‘ã€‘

  - ##### é¡¹ç›®è®¸å¯è¯é€‰æ‹©é“¾æ¥ï¼šhttps://choosealicense.com/

  - ##### ç¼–è¾‘setup.pyæ–‡ä»¶

    ```python
    # coding:utf-8
    # å¼•ç”¨åŒ…ç®¡ç†å·¥å…·setuptoolsï¼Œå…¶ä¸­find_packageså¯ä»¥å¸®æˆ‘ä»¬ä¾¿æ·çš„æ‰¾åˆ°è‡ªå·±ä»£ç ä¸­ç¼–å†™çš„åº“
    from setuptools import setup, find_packages
    
    setup(
        name='miniFrame',  # åŒ…åç§°ï¼Œä¹‹åå¦‚æœä¸Šä¼ åˆ°äº†pypiï¼Œåˆ™éœ€è¦é€šè¿‡è¯¥åç§°ä¸‹è½½
        version='0.1',  # versionåªèƒ½æ˜¯æ•°å­—ï¼Œå…¶ä»–å­—ç¬¦åˆ™ä¼šæŠ¥é”™
        keywords=('miniweb', 'miniFrame', 'heima', 'itcast'),
        description='A custom framework for use in ItCast HeiMa Python teaching',
        long_description='',
        license='MIT',  # éµå¾ªçš„åè®®
        install_requires=['redis', 'uwsgi'],  # è¿™é‡Œé¢å¡«å†™é¡¹ç›®ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹ä¾èµ–
        author='wangzhongying',
        author_email='kerbalwzy@gmail.com',
        packages=find_packages(),  # é¡¹ç›®å†…æ‰€æœ‰è‡ªå·±ç¼–å†™çš„åº“
        platforms='any',
        url='',  # é¡¹ç›®é“¾æ¥,
        include_package_data=True,
        entry_points={
            'console_scripts': [
                'miniframe=miniFrame.script:main'
            ]
        },
    )
    
    ```

  - ç¼–è¾‘LICENSEæ–‡ä»¶

    ```restructuredtext
    MIT License
    
    Copyright (c) [2018] [wangzhongying]
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
    ```

- ##### è®¾è®¡ç¼–è¾‘å®Œæˆæ¨¡å—shellå‘½ä»¤çš„Pythonè„šæœ¬

  - ##### å¸Œæœ›ã€miniFrameæˆåŠŸå®‰è£…åˆ°å¼€å‘ç¯å¢ƒä¸­åã€‘å®ç°çš„æ•ˆæœ

    - ###### åœ¨ç»ˆç«¯ä¸­è¾“å…¥ ` miniFrame info `åœ¨ç»ˆç«¯ä¸­æ‰“å°å‡ºå…³äºminiFrameæ¡†æ¶çš„ç›¸å…³ä¿¡æ¯

    - ###### åœ¨ç»ˆç«¯ä¸­è¾“å…¥`miniFrame startproject <project name>` åœ¨å½“å‰è·¯å¾„åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å¹¶å®Œæˆæ–‡ä»¶åˆå§‹åŒ–

  - ##### ç¼–è¾‘ miniFrame/script.pyæ–‡ä»¶

    ```python
    # coding:utf-8
    import os
    import sys
    
    command_tip = "The command only provides two of the following currently:\n" \
                  "\tminiframe startproject\t<project_name>\t\tThis would create a project dictionary by <project_name> \n" \
                  "\tminiframe info\tintroduce the miniFrame\n" \
                  "enjoy!"
    
    manager_content = b"# coding:utf-8\nimport os\nimport sys\nfrom miniFrame.core import MiniFrame\n\nBaseDir = os.path.dirname(os.path.abspath(__file__))\nsys.path.insert(0, BaseDir)\nCONFIG_IMPORT_PATH = 'ApiStore.config'\n\n\ndef application(env, start_response):\n    try:\n        mini_app = MiniFrame()\n        mini_app.init_app(config_import_path=CONFIG_IMPORT_PATH)\n    except Exception as e:\n        raise e\n    else:\n        return mini_app(env=env, set_resp_headers=start_response)\n\n\nif __name__ == '__main__':\n    pass\n"
    
    config_content = b'# coding:utf-8\n# these are the configs for this Project\n\n"""\n\xe9\x85\x8d\xe7\xbd\xae\xe6\x96\x87\xe4\xbb\xb6,\xe9\x85\x8d\xe7\xbd\xae\xe9\xa1\xb9\xe5\x8f\x98\xe9\x87\x8f\xe5\x90\x8d\xe7\x9a\x84\xe5\xaf\xb9\xe5\xba\x94\xe7\x9a\x84\xe6\x95\xb0\xe6\x8d\xae\xe7\xb1\xbb\xe5\x9e\x8b\xe5\xbf\x85\xe9\xa1\xbb\xe6\x98\xaf\xe5\x88\x97\xe8\xa1\xa8\xe6\x88\x96\xe5\xad\x97\xe5\x85\xb8,\xe5\x90\xa6\xe5\x88\x99\xe5\x8f\xaf\xe8\x83\xbd\xe9\x80\xa0\xe6\x88\x90\xe6\xad\xa4\xe9\x85\x8d\xe7\xbd\xae\xe9\xa1\xb9\xe6\x97\xa0\xe6\xb3\x95\xe8\xa2\xab\xe5\x8a\xa0\xe8\xbd\xbd.\n\xe5\xb7\xb2\xe7\xbb\x8f\xe9\xa2\x84\xe8\xae\xbe\xe5\xa5\xbd\xe7\x9a\x84\xe9\x85\x8d\xe7\xbd\xae\xe9\xa1\xb9\xe7\x9a\x84\xe5\x8f\x98\xe9\x87\x8f\xe5\x90\x8d\xe4\xb8\x8d\xe5\x85\x81\xe8\xae\xb8\xe4\xbf\xae\xe6\x94\xb9.\n\xe5\x85\x81\xe8\xae\xb8\xe6\xb7\xbb\xe5\x8a\xa0\xe7\xac\xa6\xe5\x90\x88\xe8\xa7\x84\xe5\x88\x99\xe7\x9a\x84\xe8\x87\xaa\xe5\xae\x9a\xe4\xb9\x89\xe9\x85\x8d\xe7\xbd\xae\xe9\xa1\xb9,\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x9c\xa8\xe4\xbb\xa3\xe7\xa0\x81\xe4\xb8\xad\xe9\x80\x9a\xe8\xbf\x87\xe5\x85\xa8\xe5\xb1\x80\xe7\x9a\x84 MiniFrame.\n"""\n# \xe5\x8a\xa0\xe5\xaf\x86\xe6\xb7\xb7\xe6\xb7\x86\xe5\xad\x97\xe7\xac\xa6\xe4\xb8\xb2\nSECRET_KEY = "Please set your secret key here"\n\n# \xe8\xb7\xaf\xe7\x94\xb1\xe5\xaf\xbc\xe5\x8c\x85\xe8\xb7\xaf\xe5\xbe\x84\nROUTERS_PATH = [\n    \'ApiStore.routers\'\n]\n\n# \xe5\x85\x81\xe8\xae\xb8\xe8\xae\xbf\xe9\x97\xae\xe7\x9a\x84\xe5\x9f\x9f\xe5\x90\x8d\nALLOW_ORIGIN = [\n    \'127.0.0.1:8000\'\n]\n\n# \xe4\xb8\xad\xe9\x97\xb4\xe4\xbb\xb6\xe7\x9a\x84\xe5\xaf\xbc\xe5\x8c\x85\xe8\xb7\xaf\xe5\xbe\x84\nMIDDLEWARE_PATH = [\n    \'ApiStore.middleware\'\n]\n\n# \xe6\x95\xb0\xe6\x8d\xae\xe5\xba\x93\xe7\x9a\x84\xe7\x9b\xb8\xe5\x85\xb3\xe9\x85\x8d\xe7\xbd\xae\nDATABASE_CONFIG = {\n    "MySQL": {\n        "host": "127.0.0.1",\n        "port": 3306,\n        "database": "miniframe",\n        "user": "root",\n        "password": "mysql"\n    },\n    "Redis": {\n        "host": \'127.0.0.1\',\n        "port": 6379,\n        "database": 0\n\n    }\n}\n'
    
    router_content = b"# coding:utf-8\nfrom miniFrame.http.url import re_path\nfrom ApiViews import exampleViews\n\npath_map = [\n    re_path(r'^/$', exampleViews.ExcampleViewSet.as_view()),\n    re_path(r'^/index/(?P<testParam>.+)/$', exampleViews.excampleViewFunc),\n\n]\n"
    
    middleware_content = b"# coding:utf-8\n"
    
    models_content = b"# coding:utf-8\n"
    
    exampleView_content = b'# coding:utf-8\nfrom miniFrame.view import APIViewSet\nfrom miniFrame.http.response import HTTPResponse, JsonResponse\n\n\nclass ExcampleViewSet(APIViewSet):\n\n    def get(self, request):\n        print("#" * 20, "ExcampleViewSet.get")\n        print("path prams data:", request.path_data)\n        print("query string and request body data:", request.req_data)\n        return HTTPResponse(data="Hello GET")\n\n    def post(self, request):\n        print("#" * 20, "ExcampleViewSet.post")\n        print("path prams data:", request.path_data)\n        print("query string and request body data:", request.req_data)\n        return HTTPResponse(data="Hello POST")\n\n\ndef excampleViewFunc(request, method=[\'GET\']):\n    print("#" * 20, "excampleViewFunc")\n    print("path prams data:", request.path_data)\n    print("query string and request body data:", request.req_data)\n    return JsonResponse(data={"hello": "excampleViewFunc"})\n'
    
    uwsgi_ini_content = "[uwsgi]\n;socket = 127.0.0.1:8000\nhttp = 127.0.0.1:8000\nchdir = {}\nwsgi-file = {}\n"
    
    ###################################################################################   
    
    def main():
        args = sys.argv
        if len(args) < 2:
            print(command_tip)
            return
    
        if args[1] not in ['startproject', 'info']:
            print(command_tip)
            return
    
        command_exec_path = os.getcwd()
        if args[1] == 'startproject':
            project_path = command_exec_path + '/' + args[2]
            if not project_path.endswith('/'):
                ApiStore_path = project_path + '/' + "ApiStore"
                ApiViews_path = project_path + '/' + "ApiViews"
            else:
                ApiStore_path = project_path + "ApiStore"
                ApiViews_path = project_path + "ApiViews"
    
            os.mkdir(project_path)
            os.mkdir(ApiStore_path)
            os.mkdir(ApiViews_path)
    
            with open(project_path + '/' + 'manager.py', 'wb') as f:
                f.write(manager_content)
            with open(project_path + '/' + 'uwsgi.ini', 'w') as f:
                content = uwsgi_ini_content.format(
                    project_path,
                    project_path + '/' + 'manager.py'
                )
                f.write(content)
    
            with open(ApiStore_path + '/' + '__init__.py', 'wb') as f:
                f.write(b"")
            with open(ApiStore_path + '/' + 'config.py', 'wb') as f:
                f.write(config_content)
            with open(ApiStore_path + '/' + 'routers.py', 'wb') as f:
                f.write(router_content)
            with open(ApiStore_path + '/' + 'middleware.py', 'wb') as f:
                f.write(middleware_content)
            with open(ApiStore_path + '/' + 'models.py', 'wb') as f:
                f.write(models_content)
    
            with open(ApiViews_path + '/' + '__init__.py', 'wb') as f:
                f.write(b'')
            with open(ApiViews_path + '/' + 'exampleViews.py', 'wb') as f:
                f.write(exampleView_content)
    
            print('Created project on path:', project_path)
    
        if args[1] == 'info':
            print("\tThis is a teaching WEB framework for Python of Shenzhen dark horse programmers.\n"
                  "\tAuthor:\tWang Zhongying\n"
                  "\tE-mail:\tkerbalwzy@gmail.com")
    
    ```

  - é€šè¿‡ `python setup.py install `å®‰è£…æˆ‘ä»¬è‡ªå·±å¼€å‘çš„æ¨¡å—ï¼ŒæˆåŠŸååœ¨ç¯å¢ƒçš„site-packagesæ–‡ä»¶å¤¹ä¸­ä¼šå‡ºç°ä¸€ä¸ªminiFrame-0.1-py3.6.eggæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾

    ![image-20180809152634424](./media/work-miniFrame-images/image-20180809152634424.png)

    è‡³æ­¤ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ¡†æ¶å°±å·²ç»å®‰è£…å¥½äº†ï¼Œå¿«ä½¿ç”¨å‘½ä»¤åˆ›å»ºé¡¹ç›®æµ‹è¯•ä¸€ä¸‹å§

  ------

  # æ€»ç»“ï¼š

  â€‹	æœ¬æ¬¡è¯¾ç¨‹ä¸­å­¦ä¹ çš„æŸäº›å†…å®¹å’ŒminiFrameé—ç•™äº†è®¸å¤šçš„åŠŸèƒ½è¿˜æ²¡æœ‰å®Œæˆï¼Œå¹¶ä¸”ä»£ç ä¹Ÿä¸å¤Ÿä¼˜ç¾ï¼Œå®é™…è¿è¡Œä¸­è¿˜æœ‰å¯èƒ½å‡ºç°å¤§å †çš„BUGã€‚ä½†å¸Œæœ›åŒå­¦ä»¬æ˜ç™½ï¼Œå­¦ä¹ å¼€å‘è¿™ä¸ªWEBæ¡†æ¶ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†çœŸæ­£å‘å¸ƒä¸€ä¸ªå…¨æ–°çš„PythonWEBæ¡†æ¶ã€‚åªæ˜¯ä¸ºäº†è®©åŒå­¦ä»¬å¯¹WEBæ¡†æ¶å¯¹è¯·æ±‚çš„å¤„ç†ï¼Œå¯¹ä¸€äº›åŠŸèƒ½çš„å®ç°åŸç†æœ‰ä¸€ä¸ªæ›´æ·±åˆ»çš„ç†è§£ï¼Œå¸Œæœ›æœªæ¥å¤§å®¶åœ¨å·¥ä½œä¸­å­¦ä¹ ä¸WEBç›¸å…³çš„æ–°çŸ¥è¯†æ—¶èƒ½å¤Ÿæ›´åŠ è½»æ¾ï¼Œæ›´åŠ é«˜æ•ˆã€‚å¦å¤–ï¼Œä¸»è¦æ˜¯ä½œè€…æœ¬äººèƒ½åŠ›æœ‰é™ï¼Œæ˜¯åœ¨æ— åŠ›ä¸€ä¸ªäººåœ¨çŸ­æ—¶é—´å†…å¼€å‘å‡ºä¸€æ¬¾åˆæ ¼çš„WEBæ¡†æ¶ã€‚

$$
Author:WangZhongyingÂ·Â·Â·Â·Email:kerbalwzy@gmail.comÂ·Â·Â·Â·Completion Date:2018/08/09
$$

