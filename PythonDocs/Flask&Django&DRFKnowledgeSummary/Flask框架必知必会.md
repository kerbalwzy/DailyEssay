Flask框架必知必会

----

1.WEB框架的作用

```
在整体的后端服务中,框架的主要作用是进行路由匹配和执行具体的业务视图.
Flask框架可以帮助我们快速的开发应用,将主要的精力放在具体的业务视图代码上,提高开发的效率.
```

2.Flask框架的核心

```
Werkzeug: WSGI工具箱,主要用来处理路由
Jinja2:模版引擎,做模版渲染
```

3.创建一个简单的Flask应用的基本步骤

```
1.从安装的flask模块中导入 Flask 类
2.通过Flask类创建app对象, 初始化必传参数为import_name, 参数值为当前文件名 __name__
3.定义视图函数,并使用@app.route()进行装饰,装饰器的两个参数常用参数分别是rule和methods,
参数rule是请求路径,对应的参数值数据类型是字符串.参数methods是请求方式,对应的参数值数据类型是列表,
列表中包含的元素为"get", "post"等请求方式名称的字符串
4.最后调用app.run()方法启动应用,默认的HOST是127.0.0.1,默认的PORT是5000. run方法中通常可以通过
设置参数 debug=True 来开启调试模式
```

4.通过正则从路由中获取参数「如何添加自定义的转换器」

```
Flask框架自带5个转换器能从路由中获取参数,但是并不能完全满足我们的需求,所以我们需要一个万能的正则转换器,
能够自己制定匹配规则.

添加自定义具体实现步骤为：
导入转换器基类：在 Flask 中，所有的路由的匹配规则都是使用转换器对象进行记录
自定义转换器：自定义类继承于转换器基类
添加转换器到默认的转换器字典中
使用自定义转换器实现自定义匹配规则

从路由获取的参数应该直接被视图函数接收,并且视图函数中的参数名称要与路由中参数名称保持一致
```

5.获取请求参数与返回响应数据

```
1.获取请求参数,request对象:
	我们可以通过从flask模块中导入的request对象,在视图函数中获取本次请求的数据
	request对象的常用属性:
		args	获取查询字符串中的参数
		form	获取表单提交的参数
		data	获取请求体中不能被form属性获取到的参数, 例如前端发送给后端的JSON数据
		cookies	获取请求头中携带的cookie信息
		method	获取本次请求的方式
		url		获取本次请求的路径
		headers	获取本次请求的请求头信息
		file	获取前端上传的文件
		
2.返回响应数据,response对象:
	我们可以通过flask模块中的make_response、jsonify、redirect等多种方式创建响应对象
	response对象常用属性和方法:
		set_cookie	在响应头中设置cookie信息,交给浏览器保存
		headers		类似于字典,可以添加额外的响应头
		status_code		属性,可以修改响应状态码
```

6.状态保持

```
需求与作用:因为HTTP协议是无状态的协议,两次请求间互相不知道.但有的时候我们在业务中需要知道用户的之前做了
哪些操作,需要记录用户的一些业务状态,因此有了状态保持的需求

实现工具: cookie 和 session
cookie的特点:
	1.保存在客户端「浏览器」中,可以设置过期时间
	2.由后端通过响应头设置
	3.每次向后端发送请求,浏览器都是自动将所有的cookie信息附带到请求头中.
session的特点:
	1.保存在服务器端,可以设置过期时间
	2.依赖于cookie
	3.以键值对的形式保存session信息
	
理解session依赖于cookie:
	1.重要的数据,我们不可能存放在客户端,而是存放在服务器端,这里使用session去保存
	2.session存放信息是键值对的形式,键可以看作一个id
	3.在cookie中存放这个session信息的id
	4.每次浏览器发送请求都会携带cookie信息.
	5.我们可以通过cookie中保存的id找到相应的session信息
	6.通过找到的session信息,就可以知道这些重要数据了
	总结:需要通过cookie中保存的sessionID获取到具体的session信息,所以session依赖于cookie
	
使用方法:
	cookie 	在视图函数中通过response对象的set_cookie(key,value)方法设置,
	session	从flask模块导入,在视图函数中将session当作字典使用,设置session的时候会自动设置一个cookie用来保存sessionID
```

7.请求钩子

```
作用:在程序的运行过程中的特定的时间节点上插入一些操作
before_first_request	在处理第一个请求前执行, 只会执行一次

before_request		在每次请求前执行;如果在某修饰的钩子函数中返回了一个响应，视图函数将不再被调用,请求
处理流程直接结束.

after_request		如果没有抛出错误，在每次请求后执行;接受一个参数(视图函数作出的响应),在此函数中可以
对响应值在返回之前做最后一步修改处理,需要将参数中的响应在此函数中进行返回

teardown_request	无论是否出现异常,在每次请求后执行;接受一个参数(如果有相关错误抛出,则为错误信息.否则
为None)
```

8.异常捕获

```
通过 app.errorhandler(异常类型) 装饰一个函数,可以捕获到特定的异常,并使用这个函数处理.这个函数必须接受一
个参数为 异常对象 ;函数必须有返回值,返回值类型为字符串或response对象
```

9.上下文

```
上下文理解:在程序运行过程中需要使用到的一些数据或对象
Flask框架中的上下文:
	请求上下文: request对象、session对象
	应用上下文: current_app对象「代表当前app对象」、g对象「一个全局临时变量」
    
两者区别：
请求上下文：保存了客户端和服务器交互的数据
应用上下文：flask 应用程序运行过程中，保存的一些配置信息，比如程序名、数据库连接.
```

10.Flask-Script模块的作用

```
1.管理app对象,让我们可以通过命令行启动时 动态的设置IP和PORT
2.添加自定义的命令,比如数据库迁移命令
```

11.操作数据库

```
方法:	通过ORM模块操作
常用的ORM模块名称:	FLask-SQLAlchemy
ORM模块的作用: 将我们面向对象的操作转换为SQL语句交给数据库服务器运行

数据模型类的定义:
	1.给app对象添加链接数据库的配置信息
	2.从flask_sqlalchemy中导入 SQLAlchemy 类,并创建db对象,对象初始化时需要将app对象传入.
	3.创建数据模型类,使用db.Model作为父类,类属性就是字段

数据库迁移:
	作用:让数据库中的表与我们的数据模型类保持一致
	命令选项: init、migrate、upgrade、downgrade
```

12.蓝图

```
作用:将不同的功能分开封装到不同的蓝图中,蓝图可以看作一个模块.这个模块通过蓝图对象与主应用的app对象产生关系.

使用方法:
	1.创建蓝图对象,具体代码类似于app对象的创建
	2.使用蓝图对象注册路由和视图函数
	3.在app对像中注册蓝图对象
注册方法:
	app.register_blueprint(蓝图对象,url_prefix='URL前缀')
```

